<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。 - Qiita Backup</title><meta name=description content="タイトルが長い(´・ω・｀) ただこう書くほかない(´・ω・｀) 掲題の通りTECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽し"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Qiita Backup","url":"https:\/\/nekotheshadow.github.io\/qiita-backup"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/nekotheshadow.github.io\/qiita-backup"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/nekotheshadow.github.io\/qiita-backup","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/nekotheshadow.github.io\/qiita-backup\/blog\/6c39cbade45d5b38fbb5\/","name":"T e c h p l a y「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。","description":"タイトルが長い(´・ω・｀) ただこう書くほかない(´・ω・｀) 掲題の通りTECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽し","inLanguage":"en","wordCount":2567,"datePublished":"2018-07-15T21:48:00","dateModified":"2018-07-15T21:48:00","image":"https:\/\/nekotheshadow.github.io\/qiita-backup","keywords":["Ruby"],"mainEntityOfPage":"https:\/\/nekotheshadow.github.io\/qiita-backup\/blog\/6c39cbade45d5b38fbb5\/","publisher":{"@type":"Organization","name":"https:\/\/nekotheshadow.github.io\/qiita-backup","logo":{"@type":"ImageObject","url":"https:\/\/nekotheshadow.github.io\/qiita-backup","height":60,"width":60}}}</script><meta property="og:title" content="TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。"><meta property="og:description" content="タイトルが長い(´・ω・｀) ただこう書くほかない(´・ω・｀) 掲題の通りTECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽し"><meta property="og:url" content="https://nekotheshadow.github.io/qiita-backup/blog/6c39cbade45d5b38fbb5/"><meta property="og:type" content="website"><meta property="og:site_name" content="Qiita Backup"><meta name=twitter:title content="TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。"><meta name=twitter:description content="タイトルが長い(´・ω・｀) ただこう書くほかない(´・ω・｀) 掲題の通りTECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽し"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><link rel=alternate href=https://nekotheshadow.github.io/qiita-backup/index.xml type=application/rss+xml title="Qiita Backup"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://nekotheshadow.github.io/qiita-backup/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://nekotheshadow.github.io/qiita-backup/css/syntax.css><link rel=stylesheet href=https://nekotheshadow.github.io/qiita-backup/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://nekotheshadow.github.io/qiita-backup>Qiita Backup</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=blog-heading><h1>TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」掲載のアルゴリズム問題を解きました。</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>タイトルが長い(´・ω・｀) ただこう書くほかない(´・ω・｀) 掲題の通り<a href="https://techplay.jp/column/298?utm_source=column_298&utm_medium=social&utm_campaign=feed&utm_content=tw0">TECH PLAY「定番のアルゴリズムは退屈？アルゴリズムをもっと楽しく学ぼう！」</a>に掲載されているアルゴリズム問題を解いてみました。解答内容は自由に公開してよいとのことなので、せっかくですし、Qiitaにさらしてみたいと思います。</p><p>詳細な問題内容は当該記事を見ていただきたいのですが、おおよその内容としては「3x3の魔法陣を生成する。魔法陣を構成する数字はnからn+8まで(nは1以上10以下)」というものです。まず思いつくのは「考えうるすべての盤面を生成して、そのうち条件を満たすものだけをpickupする」という解法でしょうか。要は全探索するわけです。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby:wrong.rb data-lang=ruby:wrong.rb><span style=color:#75715e>#</span>
<span style=color:#75715e># 考えうる魔法陣をすべて生成して、そのうち条件を満たすものだけをpickupする。</span>
<span style=color:#75715e># @param n 問題文にある&#34;n&#34;(1..10)</span>
<span style=color:#75715e># @return 条件を満たす魔法陣の一覧</span>
<span style=color:#75715e>#</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve</span>(n)
  <span style=color:#f92672>[*</span>n<span style=color:#f92672>..</span>(n <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>)<span style=color:#f92672>].</span>permutation<span style=color:#f92672>.</span>with_object(<span style=color:#f92672>[]</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>digits, squares<span style=color:#f92672>|</span>
    square <span style=color:#f92672>=</span> digits<span style=color:#f92672>.</span>each_slice(<span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>to_a    
    totals <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
      <span style=color:#f92672>*</span>square<span style=color:#f92672>.</span>map(<span style=color:#f92672>&amp;</span><span style=color:#e6db74>:sum</span>),                   <span style=color:#75715e># 縦方向</span>
      <span style=color:#f92672>*</span>square<span style=color:#f92672>.</span>transpose<span style=color:#f92672>.</span>map(<span style=color:#f92672>&amp;</span><span style=color:#e6db74>:sum</span>),         <span style=color:#75715e># 横方向</span>
      (<span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>x<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>][</span>x<span style=color:#f92672>]</span>}<span style=color:#f92672>.</span>sum,    <span style=color:#75715e># 右ななめ</span>
      (<span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>x<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>][</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> x<span style=color:#f92672>]</span>}<span style=color:#f92672>.</span>sum <span style=color:#75715e># 左ななめ</span>
    <span style=color:#f92672>]</span>
    squares <span style=color:#f92672>&lt;&lt;</span> square <span style=color:#66d9ef>if</span> totals<span style=color:#f92672>.</span>uniq<span style=color:#f92672>.</span>length <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>

<span style=color:#75715e>#</span>
<span style=color:#75715e># 3x3の魔法陣をpretty-printする。</span>
<span style=color:#75715e># 補助関数=メインロジックには無関係。</span>
<span style=color:#75715e>#</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pprint</span>(squares)
  (<span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>x<span style=color:#f92672>|</span>
    rows <span style=color:#f92672>=</span> squares<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>square<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>]</span>}
    puts rows<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>row<span style=color:#f92672>|</span>
      row<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> format(<span style=color:#e6db74>&#34;%02d&#34;</span>, digit)}<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;,&#39;</span>)
    }<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39; | &#39;</span>)
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>**</span><span style=color:#66d9ef>FILE</span><span style=color:#f92672>**</span> <span style=color:#f92672>==</span> $0
  (<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span><span style=color:#ae81ff>10</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>n<span style=color:#f92672>|</span>
    squares <span style=color:#f92672>=</span> solve(n)

    puts <span style=color:#e6db74>&#34;[ n=</span><span style=color:#e6db74>#{</span>n<span style=color:#e6db74>}</span><span style=color:#e6db74> ]&#34;</span>
    pprint(squares)
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>この実行結果が以下の通り。</p><pre><code>$ time ruby wrong.rb
[ n=1 ]
02,07,06 | 02,09,04 | 04,03,08 | 04,09,02 | 06,01,08 | 06,07,02 | 08,01,06 | 08,03,04
09,05,01 | 07,05,03 | 09,05,01 | 03,05,07 | 07,05,03 | 01,05,09 | 03,05,07 | 01,05,09
04,03,08 | 06,01,08 | 02,07,06 | 08,01,06 | 02,09,04 | 08,03,04 | 04,09,02 | 06,07,02
[ n=2 ]
03,08,07 | 03,10,05 | 05,04,09 | 05,10,03 | 07,02,09 | 07,08,03 | 09,02,07 | 09,04,05
10,06,02 | 08,06,04 | 10,06,02 | 04,06,08 | 08,06,04 | 02,06,10 | 04,06,08 | 02,06,10
05,04,09 | 07,02,09 | 03,08,07 | 09,02,07 | 03,10,05 | 09,04,05 | 05,10,03 | 07,08,03
[ n=3 ]
04,09,08 | 04,11,06 | 06,05,10 | 06,11,04 | 08,03,10 | 08,09,04 | 10,03,08 | 10,05,06
11,07,03 | 09,07,05 | 11,07,03 | 05,07,09 | 09,07,05 | 03,07,11 | 05,07,09 | 03,07,11
06,05,10 | 08,03,10 | 04,09,08 | 10,03,08 | 04,11,06 | 10,05,06 | 06,11,04 | 08,09,04
[ n=4 ]
05,10,09 | 05,12,07 | 07,06,11 | 07,12,05 | 09,04,11 | 09,10,05 | 11,04,09 | 11,06,07
12,08,04 | 10,08,06 | 12,08,04 | 06,08,10 | 10,08,06 | 04,08,12 | 06,08,10 | 04,08,12
07,06,11 | 09,04,11 | 05,10,09 | 11,04,09 | 05,12,07 | 11,06,07 | 07,12,05 | 09,10,05
[ n=5 ]
06,11,10 | 06,13,08 | 08,07,12 | 08,13,06 | 10,05,12 | 10,11,06 | 12,05,10 | 12,07,08
13,09,05 | 11,09,07 | 13,09,05 | 07,09,11 | 11,09,07 | 05,09,13 | 07,09,11 | 05,09,13
08,07,12 | 10,05,12 | 06,11,10 | 12,05,10 | 06,13,08 | 12,07,08 | 08,13,06 | 10,11,06
[ n=6 ]
07,12,11 | 07,14,09 | 09,08,13 | 09,14,07 | 11,06,13 | 11,12,07 | 13,06,11 | 13,08,09
14,10,06 | 12,10,08 | 14,10,06 | 08,10,12 | 12,10,08 | 06,10,14 | 08,10,12 | 06,10,14
09,08,13 | 11,06,13 | 07,12,11 | 13,06,11 | 07,14,09 | 13,08,09 | 09,14,07 | 11,12,07
[ n=7 ]
08,13,12 | 08,15,10 | 10,09,14 | 10,15,08 | 12,07,14 | 12,13,08 | 14,07,12 | 14,09,10
15,11,07 | 13,11,09 | 15,11,07 | 09,11,13 | 13,11,09 | 07,11,15 | 09,11,13 | 07,11,15
10,09,14 | 12,07,14 | 08,13,12 | 14,07,12 | 08,15,10 | 14,09,10 | 10,15,08 | 12,13,08
[ n=8 ]
09,14,13 | 09,16,11 | 11,10,15 | 11,16,09 | 13,08,15 | 13,14,09 | 15,08,13 | 15,10,11
16,12,08 | 14,12,10 | 16,12,08 | 10,12,14 | 14,12,10 | 08,12,16 | 10,12,14 | 08,12,16
11,10,15 | 13,08,15 | 09,14,13 | 15,08,13 | 09,16,11 | 15,10,11 | 11,16,09 | 13,14,09
[ n=9 ]
10,15,14 | 10,17,12 | 12,11,16 | 12,17,10 | 14,09,16 | 14,15,10 | 16,09,14 | 16,11,12
17,13,09 | 15,13,11 | 17,13,09 | 11,13,15 | 15,13,11 | 09,13,17 | 11,13,15 | 09,13,17
12,11,16 | 14,09,16 | 10,15,14 | 16,09,14 | 10,17,12 | 16,11,12 | 12,17,10 | 14,15,10
[ n=10 ]
11,16,15 | 11,18,13 | 13,12,17 | 13,18,11 | 15,10,17 | 15,16,11 | 17,10,15 | 17,12,13
18,14,10 | 16,14,12 | 18,14,10 | 12,14,16 | 16,14,12 | 10,14,18 | 12,14,16 | 10,14,18
13,12,17 | 15,10,17 | 11,16,15 | 17,10,15 | 11,18,13 | 17,12,13 | 13,18,11 | 15,16,11

real    0m34.338s
user    0m33.750s
sys     0m0.203s
</code></pre><p>わたしの環境ではプログラム実行から結果が返ってくるまでおよそ35秒かかっています。9!=362880通りの盤面を探索する必要があるので、これぐらいの時間がかかってしまうのは仕方がない&ndash;というよりは35万件以上探索してもこの程度の時間で済むという印象のほうが強いかも(´・ω・｀)</p><p>それはさておき、もう少し効率の良いアルゴリズムを考えてみます。たとえばn=1のときは15というように、1列の合計値は事前に求めることができます。つまり1列のうち2マスまで決まれば、最後の1マスは自動で決まります。よって「最後の1マスに数字を設定する際、縦/横/ななめ方向に合計値の検査を行って、条件を満たさない場合はその時点で探索をやめる」という枝刈りを実施すれば、単純な全探索よりは探索量が減るはずです。それを実装したものが以下のコードになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby:main.rb data-lang=ruby:main.rb><span style=color:#75715e>#</span>
<span style=color:#75715e># 幅優先探索で、条件を満たす魔法陣を探す。</span>
<span style=color:#75715e># 「探索中にその魔法陣が条件を満たすかどうかをチェックし、</span>
<span style=color:#75715e># 満たさない場合は探索をやめる」という枝刈りを行って、探索量を減らす。</span>
<span style=color:#75715e># @param n 問題文にある&#34;n&#34;(1..10)</span>
<span style=color:#75715e># @return 条件を満たす魔法陣の一覧</span>
<span style=color:#75715e>#</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve</span>(n)
  lo, hi <span style=color:#f92672>=</span> n, n <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>
  total <span style=color:#f92672>=</span> (lo<span style=color:#f92672>..</span>hi)<span style=color:#f92672>.</span>sum <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>

  queue <span style=color:#f92672>=</span> (lo<span style=color:#f92672>..</span>hi)<span style=color:#f92672>.</span>map <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span>
    square <span style=color:#f92672>=</span> Array<span style=color:#f92672>.</span>new(<span style=color:#ae81ff>3</span>){ Array<span style=color:#f92672>.</span>new(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>) }
    square<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>][</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> digit
    square
  <span style=color:#66d9ef>end</span>
  squares <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>

  <span style=color:#66d9ef>until</span> queue<span style=color:#f92672>.</span>empty?
    square <span style=color:#f92672>=</span> queue<span style=color:#f92672>.</span>shift

    <span style=color:#75715e># 数字が未設置の座標を探す。未設置の座標がない場合はその魔法陣が条件を満たすということ。</span>
    x, y <span style=color:#f92672>=</span> <span style=color:#f92672>[*</span><span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span><span style=color:#f92672>].</span>product(<span style=color:#f92672>[*</span><span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span>)<span style=color:#f92672>.</span>find{<span style=color:#f92672>|</span>i, j<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>i<span style=color:#f92672>][</span>j<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>}
    <span style=color:#66d9ef>if</span> x<span style=color:#f92672>.</span>nil? <span style=color:#f92672>&amp;&amp;</span> y<span style=color:#f92672>.</span>nil?
      squares <span style=color:#f92672>&lt;&lt;</span> square
      <span style=color:#66d9ef>next</span>
    <span style=color:#66d9ef>end</span>

    <span style=color:#75715e># 座標(x, y)に置くことができるのは、その魔法陣においていまだ利用されていない数字。</span>
    <span style=color:#75715e># ただし底辺や右辺の座標の場合は、縦方向や横方向あるいは斜め方向の検査を行っておく(=枝刈り)</span>
    digits <span style=color:#f92672>=</span> <span style=color:#f92672>[*</span>lo<span style=color:#f92672>..</span>hi<span style=color:#f92672>]</span> <span style=color:#f92672>-</span> square<span style=color:#f92672>.</span>flatten<span style=color:#f92672>.</span>uniq
    digits<span style=color:#f92672>.</span>select!{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>][</span>y<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>][</span>y<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> digit <span style=color:#f92672>==</span> total} <span style=color:#66d9ef>if</span> x <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>           <span style=color:#75715e># 底辺=縦方向の検査を行う</span>
    digits<span style=color:#f92672>.</span>select!{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>][</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>][</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> digit <span style=color:#f92672>==</span> total} <span style=color:#66d9ef>if</span> y <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>           <span style=color:#75715e># 右辺=横方向の検査を行う</span>
    digits<span style=color:#f92672>.</span>select!{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>][</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>][</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> digit <span style=color:#f92672>==</span> total} <span style=color:#66d9ef>if</span> x <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>&amp;&amp;</span> y <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#75715e># 左ななめ方向の検査を行う</span>
    digits<span style=color:#f92672>.</span>select!{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672>][</span><span style=color:#ae81ff>0</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> square<span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672>][</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> digit <span style=color:#f92672>==</span> total} <span style=color:#66d9ef>if</span> x <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>&amp;&amp;</span> y <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#75715e># 右ななめ方向の検査を行う</span>

    digits<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span>
      temp <span style=color:#f92672>=</span> square<span style=color:#f92672>.</span>map(<span style=color:#f92672>&amp;</span><span style=color:#e6db74>:dup</span>)
      temp<span style=color:#f92672>[</span>x<span style=color:#f92672>][</span>y<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> digit
      queue <span style=color:#f92672>&lt;&lt;</span> temp
    <span style=color:#66d9ef>end</span>
  <span style=color:#66d9ef>end</span>

  squares
<span style=color:#66d9ef>end</span>

<span style=color:#75715e>#</span>
<span style=color:#75715e># 3x3の魔法陣をpretty-printする。</span>
<span style=color:#75715e># 補助関数=メインロジックには無関係。</span>
<span style=color:#75715e>#</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pprint</span>(squares)
  (<span style=color:#ae81ff>0</span><span style=color:#f92672>...</span><span style=color:#ae81ff>3</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>x<span style=color:#f92672>|</span>
    rows <span style=color:#f92672>=</span> squares<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>square<span style=color:#f92672>|</span> square<span style=color:#f92672>[</span>x<span style=color:#f92672>]</span>}
    puts rows<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>row<span style=color:#f92672>|</span>
      row<span style=color:#f92672>.</span>map{<span style=color:#f92672>|</span>digit<span style=color:#f92672>|</span> format(<span style=color:#e6db74>&#34;%02d&#34;</span>, digit)}<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;,&#39;</span>)
    }<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39; | &#39;</span>)
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>**</span><span style=color:#66d9ef>FILE</span><span style=color:#f92672>**</span> <span style=color:#f92672>==</span> $0
  (<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span><span style=color:#ae81ff>10</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>n<span style=color:#f92672>|</span>
    squares <span style=color:#f92672>=</span> solve(n)

    puts <span style=color:#e6db74>&#34;[ n=</span><span style=color:#e6db74>#{</span>n<span style=color:#e6db74>}</span><span style=color:#e6db74> ]&#34;</span>
    pprint(squares)
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>これを実行したものが次の通り。</p><pre><code>$ time ruby main.rb
[ n=1 ]
02,07,06 | 02,09,04 | 04,03,08 | 04,09,02 | 06,01,08 | 06,07,02 | 08,01,06 | 08,03,04
09,05,01 | 07,05,03 | 09,05,01 | 03,05,07 | 07,05,03 | 01,05,09 | 03,05,07 | 01,05,09
04,03,08 | 06,01,08 | 02,07,06 | 08,01,06 | 02,09,04 | 08,03,04 | 04,09,02 | 06,07,02
[ n=2 ]
03,08,07 | 03,10,05 | 05,04,09 | 05,10,03 | 07,02,09 | 07,08,03 | 09,02,07 | 09,04,05
10,06,02 | 08,06,04 | 10,06,02 | 04,06,08 | 08,06,04 | 02,06,10 | 04,06,08 | 02,06,10
05,04,09 | 07,02,09 | 03,08,07 | 09,02,07 | 03,10,05 | 09,04,05 | 05,10,03 | 07,08,03
[ n=3 ]
04,09,08 | 04,11,06 | 06,05,10 | 06,11,04 | 08,03,10 | 08,09,04 | 10,03,08 | 10,05,06
11,07,03 | 09,07,05 | 11,07,03 | 05,07,09 | 09,07,05 | 03,07,11 | 05,07,09 | 03,07,11
06,05,10 | 08,03,10 | 04,09,08 | 10,03,08 | 04,11,06 | 10,05,06 | 06,11,04 | 08,09,04
[ n=4 ]
05,10,09 | 05,12,07 | 07,06,11 | 07,12,05 | 09,04,11 | 09,10,05 | 11,04,09 | 11,06,07
12,08,04 | 10,08,06 | 12,08,04 | 06,08,10 | 10,08,06 | 04,08,12 | 06,08,10 | 04,08,12
07,06,11 | 09,04,11 | 05,10,09 | 11,04,09 | 05,12,07 | 11,06,07 | 07,12,05 | 09,10,05
[ n=5 ]
06,11,10 | 06,13,08 | 08,07,12 | 08,13,06 | 10,05,12 | 10,11,06 | 12,05,10 | 12,07,08
13,09,05 | 11,09,07 | 13,09,05 | 07,09,11 | 11,09,07 | 05,09,13 | 07,09,11 | 05,09,13
08,07,12 | 10,05,12 | 06,11,10 | 12,05,10 | 06,13,08 | 12,07,08 | 08,13,06 | 10,11,06
[ n=6 ]
07,12,11 | 07,14,09 | 09,08,13 | 09,14,07 | 11,06,13 | 11,12,07 | 13,06,11 | 13,08,09
14,10,06 | 12,10,08 | 14,10,06 | 08,10,12 | 12,10,08 | 06,10,14 | 08,10,12 | 06,10,14
09,08,13 | 11,06,13 | 07,12,11 | 13,06,11 | 07,14,09 | 13,08,09 | 09,14,07 | 11,12,07
[ n=7 ]
08,13,12 | 08,15,10 | 10,09,14 | 10,15,08 | 12,07,14 | 12,13,08 | 14,07,12 | 14,09,10
15,11,07 | 13,11,09 | 15,11,07 | 09,11,13 | 13,11,09 | 07,11,15 | 09,11,13 | 07,11,15
10,09,14 | 12,07,14 | 08,13,12 | 14,07,12 | 08,15,10 | 14,09,10 | 10,15,08 | 12,13,08
[ n=8 ]
09,14,13 | 09,16,11 | 11,10,15 | 11,16,09 | 13,08,15 | 13,14,09 | 15,08,13 | 15,10,11
16,12,08 | 14,12,10 | 16,12,08 | 10,12,14 | 14,12,10 | 08,12,16 | 10,12,14 | 08,12,16
11,10,15 | 13,08,15 | 09,14,13 | 15,08,13 | 09,16,11 | 15,10,11 | 11,16,09 | 13,14,09
[ n=9 ]
10,15,14 | 10,17,12 | 12,11,16 | 12,17,10 | 14,09,16 | 14,15,10 | 16,09,14 | 16,11,12
17,13,09 | 15,13,11 | 17,13,09 | 11,13,15 | 15,13,11 | 09,13,17 | 11,13,15 | 09,13,17
12,11,16 | 14,09,16 | 10,15,14 | 16,09,14 | 10,17,12 | 16,11,12 | 12,17,10 | 14,15,10
[ n=10 ]
11,16,15 | 11,18,13 | 13,12,17 | 13,18,11 | 15,10,17 | 15,16,11 | 17,10,15 | 17,12,13
18,14,10 | 16,14,12 | 18,14,10 | 12,14,16 | 16,14,12 | 10,14,18 | 12,14,16 | 10,14,18
13,12,17 | 15,10,17 | 11,16,15 | 17,10,15 | 11,18,13 | 17,12,13 | 13,18,11 | 15,16,11

real    0m0.618s
user    0m0.406s
sys     0m0.109s
</code></pre><p>プログラム実行から同じ結果を出力するのに全探索では35秒かかっていましたが、枝刈り版では0.06秒にまで縮まっていることが分かります。上下左右対称のものを省いたり、枝刈り方法を工夫したりすれば、より効率化できそうですが、ここまで劇的な改善は難しいかもしれません(´・ω・｀)</p><div class=blog-tags><a href=https://nekotheshadow.github.io/qiita-backup/tags/ruby/>Ruby</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://nekotheshadow.github.io/qiita-backup/blog/b759028d3609a11072e0/ data-toggle=tooltip data-placement=top title="StreamでGroup By処理を行いたい(group-by-count, group-by-sum, group-by-max)">&larr; Previous Post</a></li><li class=next><a href=https://nekotheshadow.github.io/qiita-backup/blog/16255e7f36a6b355121d/ data-toggle=tooltip data-placement=top title=JPA(Hibernate)の利用時にmainメソッドの最終行まで行きついても、Javaアプリケーションが終了しない。>Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2020
&nbsp;&bull;&nbsp;
<a href=https://nekotheshadow.github.io/qiita-backup>Qiita Backup</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://nekotheshadow.github.io/qiita-backup/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://nekotheshadow.github.io/qiita-backup/js/load-photoswipe.js></script></body></html>