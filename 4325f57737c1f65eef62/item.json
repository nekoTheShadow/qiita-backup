{"rendered_body":"<h1 data-sourcepos=\"1:1-1:8\">\n<span id=\"結論\" class=\"fragment\"></span><a href=\"#%E7%B5%90%E8%AB%96\"><i class=\"fa fa-link\"></i></a>結論</h1>\n<p data-sourcepos=\"3:1-3:194\">外部エンティティを含むxmlファイルを読み込む際、FileNotFoundExceptionが発生する場合はsystemIdにXMLファイルのパスを設定すると問題が解消します。</p>\n<h1 data-sourcepos=\"5:1-5:8\">\n<span id=\"詳細\" class=\"fragment\"></span><a href=\"#%E8%A9%B3%E7%B4%B0\"><i class=\"fa fa-link\"></i></a>詳細</h1>\n<p data-sourcepos=\"7:1-7:178\">employees.xmlは従業員情報を記録したファイルです。このemployees.xmlは外部エンティティとしてemployee1.xmlとemployee2.xmlを参照しています。</p>\n<div class=\"code-frame\" data-lang=\"xml\" data-sourcepos=\"9:1-25:3\">\n<div class=\"code-lang\"><span class=\"bold\">employees.xml</span></div>\n<div class=\"highlight\"><pre><code><span class=\"cp\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span>\n<span class=\"cp\">&lt;!DOCTYPE employees [\n  &lt;!ENTITY employee1 SYSTEM \"./employee1.xml\"&gt;</span>\n  <span class=\"cp\">&lt;!ENTITY employee2 SYSTEM \"./employee2.xml\"&gt;</span>\n]&gt;\n\n<span class=\"nt\">&lt;employees&gt;</span>\n  <span class=\"nt\">&lt;employee&gt;</span>\n    <span class=\"nt\">&lt;name&gt;</span>山田<span class=\"nt\">&lt;/name&gt;</span>\n    <span class=\"nt\">&lt;role&gt;</span>社長<span class=\"nt\">&lt;/role&gt;</span>\n  <span class=\"nt\">&lt;/employee&gt;</span>\n\n  <span class=\"ni\">&amp;employee1;</span>\n  <span class=\"ni\">&amp;employee2;</span>\n<span class=\"nt\">&lt;/employees&gt;</span>\n</code></pre></div>\n</div>\n<div class=\"code-frame\" data-lang=\"xml\" data-sourcepos=\"27:1-32:3\">\n<div class=\"code-lang\"><span class=\"bold\">employee1.xml</span></div>\n<div class=\"highlight\"><pre><code><span class=\"nt\">&lt;employee&gt;</span>\n  <span class=\"nt\">&lt;name&gt;</span>鈴木<span class=\"nt\">&lt;/name&gt;</span>\n  <span class=\"nt\">&lt;role&gt;</span>営業<span class=\"nt\">&lt;/role&gt;</span>\n<span class=\"nt\">&lt;/employee&gt;</span>\n</code></pre></div>\n</div>\n<div class=\"code-frame\" data-lang=\"xml\" data-sourcepos=\"34:1-43:3\">\n<div class=\"code-lang\"><span class=\"bold\">employee2.xml</span></div>\n<div class=\"highlight\"><pre><code><span class=\"nt\">&lt;employee&gt;</span>\n  <span class=\"nt\">&lt;name&gt;</span>佐藤<span class=\"nt\">&lt;/name&gt;</span>\n  <span class=\"nt\">&lt;role&gt;</span>経理<span class=\"nt\">&lt;/role&gt;</span>\n<span class=\"nt\">&lt;/employee&gt;</span>\n<span class=\"nt\">&lt;employee&gt;</span>\n  <span class=\"nt\">&lt;name&gt;</span>田中<span class=\"nt\">&lt;/name&gt;</span>\n  <span class=\"nt\">&lt;role&gt;</span>人事<span class=\"nt\">&lt;/role&gt;</span>\n<span class=\"nt\">&lt;/employee&gt;</span>\n</code></pre></div>\n</div>\n<p data-sourcepos=\"45:1-45:166\">このemployees.xmlを読み込むことを考えて、以下のようなコードを作成&amp;実行したところjava.io.FileNotFoundExceptionが発生しました。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"47:1-57:3\"><div class=\"highlight\"><pre><code><span class=\"nc\">String</span> <span class=\"n\">xmlFile</span> <span class=\"o\">=</span> <span class=\"s\">\"D:\\\\tmp\\\\employees.xml\"</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">(</span><span class=\"nc\">InputStream</span> <span class=\"n\">inputStream</span> <span class=\"o\">=</span> <span class=\"nc\">Files</span><span class=\"o\">.</span><span class=\"na\">newInputStream</span><span class=\"o\">(</span><span class=\"nc\">Paths</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">xmlFile</span><span class=\"o\">)))</span> <span class=\"o\">{</span>\n    <span class=\"nc\">Document</span> <span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"nc\">DocumentBuilderFactory</span><span class=\"o\">.</span><span class=\"na\">newInstance</span><span class=\"o\">()</span>\n                                              <span class=\"o\">.</span><span class=\"na\">newDocumentBuilder</span><span class=\"o\">()</span>\n                                              <span class=\"o\">.</span><span class=\"na\">parse</span><span class=\"o\">(</span><span class=\"n\">inputStream</span><span class=\"o\">);</span>\n    <span class=\"c1\">// Do Something</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"nc\">IOException</span> <span class=\"o\">|</span> <span class=\"nc\">ParserConfigurationException</span> <span class=\"o\">|</span> <span class=\"nc\">SAXException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"59:1-59:640\">これはemployees.xmlの中にある外部エンティティの相対パスがうまく解決できていないことが原因です。そこで、この相対パスを解決するためのベースであるsystemIdにemployees.xmlのパスを設定します。ここでは<a href=\"https://docs.oracle.com/javase/jp/8/docs/api/javax/xml/parsers/DocumentBuilder.html#parse-java.io.InputStream-java.lang.String-\" rel=\"nofollow noopener\" target=\"_blank\">DocumentBuilderクラスのparseメソッド</a>の引数としてsystemIdにemployees.xmlのパスを設定したところ、java.io.FileNotFoundExceptionは発生せず、想定通りにxmlファイルの読み込みができました。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"61:1-71:3\"><div class=\"highlight\"><pre><code><span class=\"nc\">String</span> <span class=\"n\">xmlFile</span> <span class=\"o\">=</span> <span class=\"s\">\"D:\\\\tmp\\\\employees.xml\"</span><span class=\"o\">;</span>\n<span class=\"k\">try</span> <span class=\"o\">(</span><span class=\"nc\">InputStream</span> <span class=\"n\">inputStream</span> <span class=\"o\">=</span> <span class=\"nc\">Files</span><span class=\"o\">.</span><span class=\"na\">newInputStream</span><span class=\"o\">(</span><span class=\"nc\">Paths</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">xmlFile</span><span class=\"o\">)))</span> <span class=\"o\">{</span>\n    <span class=\"nc\">Document</span> <span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"nc\">DocumentBuilderFactory</span><span class=\"o\">.</span><span class=\"na\">newInstance</span><span class=\"o\">()</span>\n                                              <span class=\"o\">.</span><span class=\"na\">newDocumentBuilder</span><span class=\"o\">()</span>\n                                              <span class=\"o\">.</span><span class=\"na\">parse</span><span class=\"o\">(</span><span class=\"n\">inputStream</span><span class=\"o\">,</span> <span class=\"n\">xmlFile</span><span class=\"o\">);</span> <span class=\"c1\">// ★</span>\n    <span class=\"c1\">// Do Something</span>\n<span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"nc\">IOException</span> <span class=\"o\">|</span> <span class=\"nc\">ParserConfigurationException</span> <span class=\"o\">|</span> <span class=\"nc\">SAXException</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"n\">e</span><span class=\"o\">.</span><span class=\"na\">printStackTrace</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<h1 data-sourcepos=\"73:1-73:8\">\n<span id=\"環境\" class=\"fragment\"></span><a href=\"#%E7%92%B0%E5%A2%83\"><i class=\"fa fa-link\"></i></a>環境</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"75:1-83:3\"><div class=\"highlight\"><pre><code>D:\\&gt;java -version\nopenjdk version \"17.0.3\" 2022-04-19\nOpenJDK Runtime Environment Temurin-17.0.3+7 (build 17.0.3+7)\nOpenJDK 64-Bit Server VM Temurin-17.0.3+7 (build 17.0.3+7, mixed mode, sharing)\n\nD:\\&gt;javac -version\njavac 17.0.3\n</code></pre></div></div>\n","body":"# 結論\n\n外部エンティティを含むxmlファイルを読み込む際、FileNotFoundExceptionが発生する場合はsystemIdにXMLファイルのパスを設定すると問題が解消します。\n\n# 詳細\n\nemployees.xmlは従業員情報を記録したファイルです。このemployees.xmlは外部エンティティとしてemployee1.xmlとemployee2.xmlを参照しています。\n\n```employees.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE employees [\n  <!ENTITY employee1 SYSTEM \"./employee1.xml\">\n  <!ENTITY employee2 SYSTEM \"./employee2.xml\">\n]>\n\n<employees>\n  <employee>\n    <name>山田</name>\n    <role>社長</role>\n  </employee>\n\n  &employee1;\n  &employee2;\n</employees>\n```\n\n```employee1.xml\n<employee>\n  <name>鈴木</name>\n  <role>営業</role>\n</employee>\n```\n\n```employee2.xml\n<employee>\n  <name>佐藤</name>\n  <role>経理</role>\n</employee>\n<employee>\n  <name>田中</name>\n  <role>人事</role>\n</employee>\n```\n\nこのemployees.xmlを読み込むことを考えて、以下のようなコードを作成&実行したところjava.io.FileNotFoundExceptionが発生しました。\n\n```java\nString xmlFile = \"D:\\\\tmp\\\\employees.xml\";\ntry (InputStream inputStream = Files.newInputStream(Paths.get(xmlFile))) {\n    Document document = DocumentBuilderFactory.newInstance()\n                                              .newDocumentBuilder()\n                                              .parse(inputStream);\n    // Do Something\n} catch (IOException | ParserConfigurationException | SAXException e) {\n    e.printStackTrace();\n}\n```\n\nこれはemployees.xmlの中にある外部エンティティの相対パスがうまく解決できていないことが原因です。そこで、この相対パスを解決するためのベースであるsystemIdにemployees.xmlのパスを設定します。ここでは[DocumentBuilderクラスのparseメソッド](https://docs.oracle.com/javase/jp/8/docs/api/javax/xml/parsers/DocumentBuilder.html#parse-java.io.InputStream-java.lang.String-)の引数としてsystemIdにemployees.xmlのパスを設定したところ、java.io.FileNotFoundExceptionは発生せず、想定通りにxmlファイルの読み込みができました。\n\n```java\nString xmlFile = \"D:\\\\tmp\\\\employees.xml\";\ntry (InputStream inputStream = Files.newInputStream(Paths.get(xmlFile))) {\n    Document document = DocumentBuilderFactory.newInstance()\n                                              .newDocumentBuilder()\n                                              .parse(inputStream, xmlFile); // ★\n    // Do Something\n} catch (IOException | ParserConfigurationException | SAXException e) {\n    e.printStackTrace();\n}\n```\n\n# 環境\n\n```\nD:\\>java -version\nopenjdk version \"17.0.3\" 2022-04-19\nOpenJDK Runtime Environment Temurin-17.0.3+7 (build 17.0.3+7)\nOpenJDK 64-Bit Server VM Temurin-17.0.3+7 (build 17.0.3+7, mixed mode, sharing)\n\nD:\\>javac -version\njavac 17.0.3\n```\n","coediting":false,"comments_count":0,"created_at":"2023-06-04T00:33:26+09:00","group":null,"id":"4325f57737c1f65eef62","likes_count":0,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"Java","versions":[]}],"title":"外部エンティティを含むxmlファイルを読み込みたい","updated_at":"2023-06-04T00:33:26+09:00","url":"https://qiita.com/neko_the_shadow/items/4325f57737c1f65eef62","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":37,"github_login_name":"nekoTheShadow","id":"neko_the_shadow","items_count":218,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":437,"team_membership":null,"organization_url_name":null,"slide":false}