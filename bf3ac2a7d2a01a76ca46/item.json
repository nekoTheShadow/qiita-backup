{"rendered_body":"\n<h1>\n<span id=\"事象\" class=\"fragment\"></span><a href=\"#%E4%BA%8B%E8%B1%A1\"><i class=\"fa fa-link\"></i></a>事象</h1>\n\n<p>Docker Toolbox 環境において、<code>npm install</code>が以下の理由により失敗する場合があります。</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>npm ERR! code EAI_AGAIN\nnpm ERR! errno EAI_AGAIN\nnpm ERR! request to https://registry.npmjs.org/vue-router failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org   \n</code></pre></div></div>\n\n<h1>\n<span id=\"原因\" class=\"fragment\"></span><a href=\"#%E5%8E%9F%E5%9B%A0\"><i class=\"fa fa-link\"></i></a>原因</h1>\n\n<p><strong>わたしの環境だと、原因は<code>registry.npmjs.org</code>の名前解決に失敗していることでした。</strong> とりたてて設定などをしていない場合、docker machine はホスト側(すなわちWindows)に名前解決を依頼します。そこで、ホスト側で<code>nslookup</code>を行ったところ、自分のマシンが利用しているDNSサーバには<code>registry.npmjs.org</code>が登録されていませんでした。</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>C:\\&gt;nslookup registry.npmjs.org\nサーバー:  ntt.setup\nAddress:  2408:211:605:600:5a52:8aff:fe66:f4a5\n\n*** ntt.setup が registry.npmjs.org を見つけられません: Query refused\n</code></pre></div></div>\n\n<h1>\n<span id=\"対策\" class=\"fragment\"></span><a href=\"#%E5%AF%BE%E7%AD%96\"><i class=\"fa fa-link\"></i></a>対策</h1>\n\n<p>対策方法はいろいろあると思いますが、<strong>「Dockerが利用するDNSサーバを<code>registry.npmjs.org</code>の名前解決ができるGoogle Public DNS (8.8.8.8)にする」</strong>ことで問題が解消しました。</p>\n\n<ol>\n<li>\n<code>%DOCKER_CERT_PATH%\\config.json</code> の <code>HostOptions &gt; EngineOptions &gt; Dns</code>を編集し、DNSサーバとして<code>8.8.8.8</code>を登録する。</li>\n<li>Docker Machineを再起動する (<code>docker-machine restart</code>)</li>\n</ol>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>\"DriverName\": \"virtualbox\",\n\"HostOptions\": {\n    \"Driver\": \"\",\n    \"Memory\": 0,\n    \"Disk\": 0,\n    \"EngineOptions\": {\n        \"ArbitraryFlags\": [],\n        \"Dns\": [\n            \"8.8.8.8\"\n        ],\n</code></pre></div></div>\n\n<h1>\n<span id=\"環境情報\" class=\"fragment\"></span><a href=\"#%E7%92%B0%E5%A2%83%E6%83%85%E5%A0%B1\"><i class=\"fa fa-link\"></i></a>環境情報</h1>\n\n<ul>\n<li>Microsoft Windows [Version 10.0.18362.720]</li>\n<li>docker-machine.exe version 0.16.1, build cce350d7</li>\n</ul>\n\n<p>Dockerのバージョンは次の通り:</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>Client:\n API version:       1.40\n Go version:        go1.12.7\n Git commit:        74b1e89e8a\n Built:             Wed Jul 31 15:18:18 2019\n OS/Arch:           windows/amd64\n Experimental:      false\n\nServer: Docker Engine - Community\n  Version:          19.03.5\n  API version:      1.40 (minimum version 1.12)\n  Go version:       go1.12.12\n  Git commit:       633a0ea838\n  Built:            Wed Nov 13 07:28:45 2019\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          v1.2.10\n runc:\n  Version:          1.0.0-rc8+dev\n  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657\n docker-init:\n  Version:          0.18.0\n  GitCommit:        fec3683\n</code></pre></div></div>\n","body":"# 事象\n\nDocker Toolbox 環境において、`npm install`が以下の理由により失敗する場合があります。\n\n```\nnpm ERR! code EAI_AGAIN\nnpm ERR! errno EAI_AGAIN\nnpm ERR! request to https://registry.npmjs.org/vue-router failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org   \n```\n\n# 原因\n\n__わたしの環境だと、原因は`registry.npmjs.org`の名前解決に失敗していることでした。__ とりたてて設定などをしていない場合、docker machine はホスト側(すなわちWindows)に名前解決を依頼します。そこで、ホスト側で`nslookup`を行ったところ、自分のマシンが利用しているDNSサーバには`registry.npmjs.org`が登録されていませんでした。\n\n```\nC:\\>nslookup registry.npmjs.org\nサーバー:  ntt.setup\nAddress:  2408:211:605:600:5a52:8aff:fe66:f4a5\n\n*** ntt.setup が registry.npmjs.org を見つけられません: Query refused\n```\n\n# 対策\n\n対策方法はいろいろあると思いますが、__「Dockerが利用するDNSサーバを`registry.npmjs.org`の名前解決ができるGoogle Public DNS (8.8.8.8)にする」__ことで問題が解消しました。\n\n1. `%DOCKER_CERT_PATH%\\config.json` の `HostOptions > EngineOptions > Dns`を編集し、DNSサーバとして`8.8.8.8`を登録する。\n2. Docker Machineを再起動する (`docker-machine restart`)\n\n```\n\"DriverName\": \"virtualbox\",\n\"HostOptions\": {\n    \"Driver\": \"\",\n    \"Memory\": 0,\n    \"Disk\": 0,\n    \"EngineOptions\": {\n        \"ArbitraryFlags\": [],\n        \"Dns\": [\n            \"8.8.8.8\"\n        ],\n```\n\n# 環境情報\n\n- Microsoft Windows [Version 10.0.18362.720]\n- docker-machine.exe version 0.16.1, build cce350d7\n\nDockerのバージョンは次の通り:\n\n```\nClient:\n API version:       1.40\n Go version:        go1.12.7\n Git commit:        74b1e89e8a\n Built:             Wed Jul 31 15:18:18 2019\n OS/Arch:           windows/amd64\n Experimental:      false\n\nServer: Docker Engine - Community\n  Version:          19.03.5\n  API version:      1.40 (minimum version 1.12)\n  Go version:       go1.12.12\n  Git commit:       633a0ea838\n  Built:            Wed Nov 13 07:28:45 2019\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          v1.2.10\n runc:\n  Version:          1.0.0-rc8+dev\n  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657\n docker-init:\n  Version:          0.18.0\n  GitCommit:        fec3683\n```\n\n","coediting":false,"comments_count":0,"created_at":"2020-04-12T19:26:29+09:00","group":null,"id":"bf3ac2a7d2a01a76ca46","likes_count":10,"private":false,"reactions_count":0,"stocks_count":2,"tags":[{"name":"npm","versions":[]},{"name":"Docker","versions":[]}],"title":"Docker Toolbox 環境で npm install が reason: getaddrinfo EAI_AGAIN registry.npmjs.org により失敗する。","updated_at":"2020-04-12T23:49:02+09:00","url":"https://qiita.com/neko_the_shadow/items/bf3ac2a7d2a01a76ca46","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":37,"github_login_name":null,"id":"neko_the_shadow","items_count":216,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":14195,"team_membership":null,"organization_url_name":null,"slide":false}