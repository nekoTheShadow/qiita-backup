{"rendered_body":"\n<h1>\n<span id=\"課題\" class=\"fragment\"></span><a href=\"#%E8%AA%B2%E9%A1%8C\"><i class=\"fa fa-link\"></i></a>課題</h1>\n\n<p>Rubyを利用して、インターネット上のファイルをダウンロードし、ローカルに保存したい場合はどのようにすればよいでしょうか?</p>\n\n<h1>\n<span id=\"解決策\" class=\"fragment\"></span><a href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"><i class=\"fa fa-link\"></i></a>解決策</h1>\n\n<p>まずはテキストファイルの例です。<a href=\"https://ja.wikipedia.org/wiki/HyperText_Markup_Language\" rel=\"nofollow noopener\" target=\"_blank\">Wikipedia - HyperText Markup Language</a>をHTMLファイルとしてダウンロードしたい場合は次のように書くと良いです。</p>\n\n<div class=\"code-frame\" data-lang=\"ruby\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"nb\">require</span> <span class=\"s1\">'open-uri'</span>\n\n<span class=\"n\">uri_str</span> <span class=\"o\">=</span> <span class=\"s1\">'https://ja.wikipedia.org/wiki/HyperText_Markup_Language'</span>\n<span class=\"no\">URI</span><span class=\"p\">.</span><span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"n\">uri_str</span><span class=\"p\">)</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">res</span><span class=\"o\">|</span>\n  <span class=\"no\">IO</span><span class=\"p\">.</span><span class=\"nf\">copy_stream</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"s1\">'HyperText_Markup_Language.html'</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n\n<p>画像のようなバイナリでも同じです。<a href=\"https://ja.wikipedia.org/wiki/Portable_Network_Graphics\" rel=\"nofollow noopener\" target=\"_blank\">Wikipedia - Portable Network Graphics</a>にPNGファイルの例としてあげられている画像をダウンロードしてみましょう。</p>\n\n<div class=\"code-frame\" data-lang=\"ruby\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"nb\">require</span> <span class=\"s1\">'open-uri'</span>\n\n<span class=\"n\">uri_str</span> <span class=\"o\">=</span> <span class=\"s1\">'https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png'</span>\n<span class=\"no\">URI</span><span class=\"p\">.</span><span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"n\">uri_str</span><span class=\"p\">)</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">res</span><span class=\"o\">|</span>\n  <span class=\"no\">IO</span><span class=\"p\">.</span><span class=\"nf\">copy_stream</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"s1\">'PNG_transparency_demonstration_1.png'</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n\n<h1>\n<span id=\"注意\" class=\"fragment\"></span><a href=\"#%E6%B3%A8%E6%84%8F\"><i class=\"fa fa-link\"></i></a>注意</h1>\n\n<p><code>open-uri</code>ライブラリは<code>Net::HTTP</code><code>Net::HTTPS</code><code>Net::FTP</code>などのラッパーで、httpやhttpsのURLを一般的なファイルのように扱うことができます。このライブラリは<code>Kernel#open</code>を再定義するため、以下のように書くこともできます。</p>\n\n<div class=\"code-frame\" data-lang=\"ruby\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"nb\">require</span> <span class=\"s1\">'open-uri'</span>\n\n<span class=\"n\">uri_str</span> <span class=\"o\">=</span> <span class=\"s1\">'https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png'</span>\n<span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">uri_str</span><span class=\"p\">)</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">res</span><span class=\"o\">|</span>\n  <span class=\"no\">IO</span><span class=\"p\">.</span><span class=\"nf\">copy_stream</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">,</span> <span class=\"s1\">'PNG_transparency_demonstration_1.png'</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n\n<p>ただし、Ruby2.7からは<code>open-uri</code>により拡張される<code>Kernel#open</code>を使って、URIを開くのは非推奨になりました。上記のコードをRuby2.7で実行すると、以下のような警告が出ます。</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre class=\"with-code\"><code>warning: calling URI.open via Kernel#open is deprecated, call URI.open directly or use URI#open\n</code></pre></div></div>\n\n<p>警告が出るだけで動かなくなったわけではないのですが、<code>URI#open</code>や<code>OpenURI#open_uri</code>を利用することをお勧めします。</p>\n\n<h1>\n<span id=\"環境情報\" class=\"fragment\"></span><a href=\"#%E7%92%B0%E5%A2%83%E6%83%85%E5%A0%B1\"><i class=\"fa fa-link\"></i></a>環境情報</h1>\n\n<div class=\"code-frame\" data-lang=\"bash\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"nv\">$ </span>ruby <span class=\"nt\">-v</span>\nruby 2.7.1p83 <span class=\"o\">(</span>2020-03-31 revision a0c7c23c9c<span class=\"o\">)</span> <span class=\"o\">[</span>x86_64-darwin18\n</code></pre></div></div>\n","body":"# 課題\n\nRubyを利用して、インターネット上のファイルをダウンロードし、ローカルに保存したい場合はどのようにすればよいでしょうか?\n\n# 解決策\n\nまずはテキストファイルの例です。[Wikipedia - HyperText Markup Language](https://ja.wikipedia.org/wiki/HyperText_Markup_Language)をHTMLファイルとしてダウンロードしたい場合は次のように書くと良いです。\n\n```ruby\nrequire 'open-uri'\n\nuri_str = 'https://ja.wikipedia.org/wiki/HyperText_Markup_Language'\nURI.open(uri_str) do |res|\n  IO.copy_stream(res, 'HyperText_Markup_Language.html')\nend\n```\n\n画像のようなバイナリでも同じです。[Wikipedia - Portable Network Graphics](https://ja.wikipedia.org/wiki/Portable_Network_Graphics)にPNGファイルの例としてあげられている画像をダウンロードしてみましょう。\n\n```ruby\nrequire 'open-uri'\n\nuri_str = 'https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png'\nURI.open(uri_str) do |res|\n  IO.copy_stream(res, 'PNG_transparency_demonstration_1.png')\nend\n```\n\n# 注意\n\n`open-uri`ライブラリは`Net::HTTP``Net::HTTPS``Net::FTP`などのラッパーで、httpやhttpsのURLを一般的なファイルのように扱うことができます。このライブラリは`Kernel#open`を再定義するため、以下のように書くこともできます。\n\n```ruby\nrequire 'open-uri'\n\nuri_str = 'https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png'\nopen(uri_str) do |res|\n  IO.copy_stream(res, 'PNG_transparency_demonstration_1.png')\nend\n```\n\nただし、Ruby2.7からは`open-uri`により拡張される`Kernel#open`を使って、URIを開くのは非推奨になりました。上記のコードをRuby2.7で実行すると、以下のような警告が出ます。\n\n```\nwarning: calling URI.open via Kernel#open is deprecated, call URI.open directly or use URI#open\n```\n\n警告が出るだけで動かなくなったわけではないのですが、`URI#open`や`OpenURI#open_uri`を利用することをお勧めします。\n\n# 環境情報\n\n```bash\n$ ruby -v\nruby 2.7.1p83 (2020-03-31 revision a0c7c23c9c) [x86_64-darwin18\n```\n\n\n","coediting":false,"comments_count":1,"created_at":"2020-09-17T13:18:18+09:00","group":null,"id":"747372d3cc62802550da","likes_count":2,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]}],"title":"Rubyを利用して、インターネット上のファイルをダウンロードし、ローカルに保存したい (注意点あり)","updated_at":"2020-09-17T13:25:30+09:00","url":"https://qiita.com/neko_the_shadow/items/747372d3cc62802550da","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":35,"github_login_name":null,"id":"neko_the_shadow","items_count":188,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":null,"team_membership":null}