{"rendered_body":"<p data-sourcepos=\"1:1-1:158\">SQLServerでテーブルごとの統計情報の最終更新日時を取得したい場合、<code>sys.stats</code>テーブルと<code>STATS_DATE</code>関数を活用します。</p>\n<p data-sourcepos=\"3:1-3:158\">たとえば<code>EMP</code>テーブルと<code>DEPT</code>テーブルの統計情報の最終更新日時を取得したい場合は以下のようなSQLで実現できます。</p>\n<div class=\"code-frame\" data-lang=\"sql\" data-sourcepos=\"5:1-12:3\"><div class=\"highlight\"><pre><code><span class=\"k\">SELECT</span> \n  <span class=\"n\">OBJECT_NAME</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"k\">table_name</span><span class=\"p\">,</span>\n  <span class=\"n\">name</span> <span class=\"k\">AS</span> <span class=\"n\">index_name</span><span class=\"p\">,</span>\n  <span class=\"n\">STATS_DATE</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">stats_id</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"n\">last_updated</span>\n<span class=\"k\">FROM</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">stats</span>\n<span class=\"k\">WHERE</span> <span class=\"n\">OBJECT_NAME</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">)</span> <span class=\"k\">IN</span> <span class=\"p\">(</span><span class=\"s1\">'EMP'</span><span class=\"p\">,</span> <span class=\"s1\">'DEPT'</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"14:1-14:96\">このSQLを実行すると、以下のような結果を得ることができるはずです。</p>\n<table data-sourcepos=\"16:1-24:42\">\n<thead>\n<tr data-sourcepos=\"16:1-16:36\">\n<th style=\"text-align: left\" data-sourcepos=\"16:2-16:11\">table_name</th>\n<th style=\"text-align: left\" data-sourcepos=\"16:13-16:22\">index_name</th>\n<th style=\"text-align: left\" data-sourcepos=\"16:24-16:35\">last_updated</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"18:1-18:40\">\n<td style=\"text-align: left\" data-sourcepos=\"18:2-18:4\">EMP</td>\n<td style=\"text-align: left\" data-sourcepos=\"18:6-18:15\">PK_EMP_001</td>\n<td style=\"text-align: left\" data-sourcepos=\"18:17-18:39\">2022/10/29 12:15:08.157</td>\n</tr>\n<tr data-sourcepos=\"19:1-19:40\">\n<td style=\"text-align: left\" data-sourcepos=\"19:2-19:4\">EMP</td>\n<td style=\"text-align: left\" data-sourcepos=\"19:6-19:15\">IX_EMP_001</td>\n<td style=\"text-align: left\" data-sourcepos=\"19:17-19:39\">2022/10/29 12:15:08.163</td>\n</tr>\n<tr data-sourcepos=\"20:1-20:40\">\n<td style=\"text-align: left\" data-sourcepos=\"20:2-20:4\">EMP</td>\n<td style=\"text-align: left\" data-sourcepos=\"20:6-20:15\">IX_EMP_002</td>\n<td style=\"text-align: left\" data-sourcepos=\"20:17-20:39\">2022/10/29 12:15:08.167</td>\n</tr>\n<tr data-sourcepos=\"21:1-21:40\">\n<td style=\"text-align: left\" data-sourcepos=\"21:2-21:4\">EMP</td>\n<td style=\"text-align: left\" data-sourcepos=\"21:6-21:15\">IX_EMP_003</td>\n<td style=\"text-align: left\" data-sourcepos=\"21:17-21:39\">2022/10/29 12:15:08.173</td>\n</tr>\n<tr data-sourcepos=\"22:1-22:42\">\n<td style=\"text-align: left\" data-sourcepos=\"22:2-22:5\">DEPT</td>\n<td style=\"text-align: left\" data-sourcepos=\"22:7-22:17\">PK_DEPT_001</td>\n<td style=\"text-align: left\" data-sourcepos=\"22:19-22:41\">2022/10/29 12:15:08.190</td>\n</tr>\n<tr data-sourcepos=\"23:1-23:42\">\n<td style=\"text-align: left\" data-sourcepos=\"23:2-23:5\">DEPT</td>\n<td style=\"text-align: left\" data-sourcepos=\"23:7-23:17\">IX_DEPT_001</td>\n<td style=\"text-align: left\" data-sourcepos=\"23:19-23:41\">2022/10/29 12:15:08.200</td>\n</tr>\n<tr data-sourcepos=\"24:1-24:42\">\n<td style=\"text-align: left\" data-sourcepos=\"24:2-24:5\">DEPT</td>\n<td style=\"text-align: left\" data-sourcepos=\"24:7-24:17\">IX_DEPT_002</td>\n<td style=\"text-align: left\" data-sourcepos=\"24:19-24:41\">2022/10/29 12:15:08.203</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"26:1-26:16\"><strong>環境情報</strong></p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"28:1-33:3\"><div class=\"highlight\"><pre><code>Microsoft SQL Server 2019 (RTM-CU9) (KB5000642) - 15.0.4102.2 (X64) \n\tJan 25 2021 20:16:12 \n\tCopyright (C) 2019 Microsoft Corporation\n\tDeveloper Edition (64-bit) on Linux (Ubuntu 18.04.5 LTS) &lt;X64&gt;\n</code></pre></div></div>\n","body":"SQLServerでテーブルごとの統計情報の最終更新日時を取得したい場合、`sys.stats`テーブルと`STATS_DATE`関数を活用します。\n\nたとえば`EMP`テーブルと`DEPT`テーブルの統計情報の最終更新日時を取得したい場合は以下のようなSQLで実現できます。\n\n```sql\nSELECT \n  OBJECT_NAME(object_id) AS table_name,\n  name AS index_name,\n  STATS_DATE(object_id, stats_id) AS last_updated\nFROM sys.stats\nWHERE OBJECT_NAME(object_id) IN ('EMP', 'DEPT')\n```\n\nこのSQLを実行すると、以下のような結果を得ることができるはずです。\n\n|table_name|index_name|last_updated|\n|:---|:---|:---|\n|EMP|PK_EMP_001|2022/10/29 12:15:08.157|\n|EMP|IX_EMP_001|2022/10/29 12:15:08.163|\n|EMP|IX_EMP_002|2022/10/29 12:15:08.167|\n|EMP|IX_EMP_003|2022/10/29 12:15:08.173|\n|DEPT|PK_DEPT_001|2022/10/29 12:15:08.190|\n|DEPT|IX_DEPT_001|2022/10/29 12:15:08.200|\n|DEPT|IX_DEPT_002|2022/10/29 12:15:08.203|\n\n**環境情報**\n\n```\nMicrosoft SQL Server 2019 (RTM-CU9) (KB5000642) - 15.0.4102.2 (X64) \n\tJan 25 2021 20:16:12 \n\tCopyright (C) 2019 Microsoft Corporation\n\tDeveloper Edition (64-bit) on Linux (Ubuntu 18.04.5 LTS) <X64>\n```\n\n","coediting":false,"comments_count":0,"created_at":"2022-10-29T21:24:31+09:00","group":null,"id":"158fb05a9ab80523ed88","likes_count":0,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"SQLServer","versions":[]}],"title":"SQLServerでテーブルごとの統計情報の最終更新日時を取得したい","updated_at":"2022-10-29T21:24:31+09:00","url":"https://qiita.com/neko_the_shadow/items/158fb05a9ab80523ed88","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":35,"github_login_name":null,"id":"neko_the_shadow","items_count":210,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":240,"team_membership":null,"organization_url_name":null}