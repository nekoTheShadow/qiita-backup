{"rendered_body":"<p><a href=\"https://codeiq.jp/q/2837\" rel=\"nofollow noopener\" target=\"_blank\">CodeIQ「『マイナー・ゲーム』問題」</a>の掲載期間が終わったということで、自分の提出コードを公開しておきます。なお詳しい問題の概要や解法は広大なWebの海にあると思うので、見つけ出してください<del>(実はわたしも詳しい問題の中身を覚えていないというのは内緒)</del>。またほかの方が公開されたコードが<a href=\"http://togetter.com/li/982368\" rel=\"nofollow noopener\" target=\"_blank\">Togetter</a>にまとまられておりますので、そちらのほうもぜひ。</p>\n\n<div class=\"code-frame\" data-lang=\"py\"><div class=\"highlight\"><pre><code><span class=\"c1\"># m個からn個を選ぶ組み合わせを返す\n</span><span class=\"n\">c_memo</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"k\">def</span> <span class=\"nf\">C</span><span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">c_memo</span><span class=\"p\">:</span> <span class=\"k\">return</span> <span class=\"n\">c_memo</span><span class=\"p\">[(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)]</span>\n\n    <span class=\"n\">c_memo</span><span class=\"p\">[(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"k\">if</span> <span class=\"n\">m</span> <span class=\"o\">==</span> <span class=\"n\">n</span> <span class=\"ow\">or</span> <span class=\"n\">n</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">m</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">m</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">c_memo</span><span class=\"p\">[(</span><span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)]</span>\n\n<span class=\"c1\"># 少数決によってx人からy人になる確率\n# cf. x人からy人になる確率 = (2 * C(x, y)) / (2 ** x)\n</span><span class=\"n\">g_memo</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"k\">def</span> <span class=\"nf\">G</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">g_memo</span><span class=\"p\">:</span> <span class=\"k\">return</span> <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">==</span> <span class=\"n\">y</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">%</span> <span class=\"mi\">2</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"c1\"># ex. G(4, 4): 4人から4人になる確率 + 引き分ける確率\n</span>            <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">**</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"p\">(</span><span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span> <span class=\"o\">//</span> <span class=\"mi\">2</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">**</span> <span class=\"n\">x</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">**</span> <span class=\"n\">x</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">-</span> <span class=\"n\">y</span> <span class=\"o\">&lt;=</span> <span class=\"n\">y</span><span class=\"p\">:</span> <span class=\"c1\"># ex. G(4, 3): 4人から3人になることはない\n</span>            <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">C</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">**</span> <span class=\"n\">x</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">g_memo</span><span class=\"p\">[(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)]</span>\n\n<span class=\"c1\"># 問題文中のF(n)\n</span><span class=\"k\">def</span> <span class=\"nf\">F</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">):</span>\n    <span class=\"n\">exps</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]</span>\n    <span class=\"n\">game</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n\n    <span class=\"n\">pros</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">)]</span>\n    <span class=\"n\">pros</span><span class=\"p\">[</span><span class=\"n\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n\n    <span class=\"k\">while</span> <span class=\"n\">exps</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">!=</span> <span class=\"n\">exps</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]:</span> <span class=\"c1\"># 期待値の変化が見られなくなるまでループ\n</span>        <span class=\"n\">new_pros</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">)]</span>\n        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"n\">n</span> <span class=\"o\">//</span> <span class=\"mi\">2</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">),</span> <span class=\"n\">n</span><span class=\"p\">):</span>\n            <span class=\"k\">for</span> <span class=\"n\">y</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">x</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">):</span> <span class=\"n\">new_pros</span><span class=\"p\">[</span><span class=\"n\">y</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"n\">pros</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">G</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">)</span>\n\n        <span class=\"n\">exps</span><span class=\"p\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">exps</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">game</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">new_pros</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">new_pros</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]))</span>\n        <span class=\"n\">pros</span> <span class=\"o\">=</span> <span class=\"n\">new_pros</span>\n        <span class=\"n\">game</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n\n    <span class=\"k\">return</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">exps</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">10</span> <span class=\"o\">**</span> <span class=\"mi\">6</span><span class=\"p\">))</span>\n\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span> <span class=\"o\">==</span> <span class=\"s\">'__main__'</span><span class=\"p\">:</span>\n    <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"nb\">input</span><span class=\"p\">())</span>\n    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">))</span>\n\n    <span class=\"s\">\"\"\"\n    n = 7のとき、ゲームが進むにつれて、考えられる人数は次のように推移していく\n\n    start  1回目   2回目  3回目\n　　*****************************\n     7人    1人     1人    1人\n            2人     2人    2人\n            3人     3人    3人\n            7人     7人    7人\n    \"\"\"</span>\n\n</code></pre></div></div>\n\n<p>たとえば7人で一連のゲームを始めるとします。まず1回目の少数決の結果、残る人数は1人・2人・3人・7人のどれかに決まります。1人と2人の場合、ルール上ゲームが終わってしまうので、2回目の少数決の対象になるのは3人もしくは7人の場合です。</p>\n\n<p>3人で少数決を行うと、残る人数は1人もしくは3人です。7人の場合は言うまでもなく、1人・2人・3人・7人のどれかです。つまり7人で始めたゲームについて、2回の少数決を行ったとき、残る人数の組み合わせは1人・2人・3人・7人に決まります。</p>\n\n<p>わたしの解法は以上のような手続き(?)を模したものといえます。<strong><em>つまり少数決を1回1回進めながら、残った人数について確率を求め、それをもとに期待値を計算しているのです。</em></strong>あるいは少数決の回数を重ねながら、期待値を正解に近づけていく解き方と言い換えることができるかもしれません。</p>\n\n<p>この解法の問題は「終わりがない」ということ。少数決の回数はいくらでも増やすことができるので、どこかのタイミングでゲームを中断してやる必要があります。そこで今回は<strong><em>期待値に変動がなくなった時点で、十分正解に近づいたと判断し、ゲームを中断することにしました。</em></strong></p>\n\n<hr>\n\n<ol>\n<li>疲れた身体で書いているせいか、解法の説明がポエムみたいになっています(´・ω・`)</li>\n<li>これを解いていた当時は再帰に凝っていたらしく、コード全体が(メモ化)再帰まみれ(´・ω・`)</li>\n<li>社会人になって3か月も経ってないのに、もうつらい(´・ω・`)</li>\n</ol>\n","body":"[CodeIQ「『マイナー・ゲーム』問題」](https://codeiq.jp/q/2837)の掲載期間が終わったということで、自分の提出コードを公開しておきます。なお詳しい問題の概要や解法は広大なWebの海にあると思うので、見つけ出してください~~(実はわたしも詳しい問題の中身を覚えていないというのは内緒)~~。またほかの方が公開されたコードが[Togetter](http://togetter.com/li/982368)にまとまられておりますので、そちらのほうもぜひ。\n\n```py\n# m個からn個を選ぶ組み合わせを返す\nc_memo = {}\ndef C(m, n):\n    if (m, n) in c_memo: return c_memo[(m, n)]\n\n    c_memo[(m, n)] = 1 if m == n or n == 0 else C(m - 1, n - 1) + C(m - 1, n)\n    return c_memo[(m, n)]\n\n# 少数決によってx人からy人になる確率\n# cf. x人からy人になる確率 = (2 * C(x, y)) / (2 ** x)\ng_memo = {}\ndef G(x, y):\n    if (x, y) in g_memo: return g_memo[(x, y)]\n\n    if x == y:\n        if x % 2 == 0: # ex. G(4, 4): 4人から4人になる確率 + 引き分ける確率\n            g_memo[(x, y)] = (2 * C(x, y)) / (2 ** x) + (C(x, y // 2)) / (2 ** x)\n        else:\n            g_memo[(x, y)] = (2 * C(x, y)) / (2 ** x)\n    else:\n        if x - y <= y: # ex. G(4, 3): 4人から3人になることはない\n            g_memo[(x, y)] = 0\n        else:\n            g_memo[(x, y)] = (2 * C(x, y)) / (2 ** x)\n\n    return g_memo[(x, y)]\n\n# 問題文中のF(n)\ndef F(n):\n    exps = [-1, 0]\n    game = 1\n\n    pros = [0 for _ in range(n + 1)]\n    pros[n] = 1\n\n    while exps[-2] != exps[-1]: # 期待値の変化が見られなくなるまでループ\n        new_pros = [0 for _ in range(n + 1)]\n        for x in (*range(3, n // 2 + 1), n):\n            for y in range(1, x + 1): new_pros[y] += pros[x] * G(x, y)\n\n        exps.append(exps[-1] + game * (new_pros[1] + new_pros[2]))\n        pros = new_pros\n        game += 1\n\n    return int(exps[-1] * (10 ** 6))\n\n\nif __name__ == '__main__':\n    n = int(input())\n    print(F(n))\n\n    \"\"\"\n    n = 7のとき、ゲームが進むにつれて、考えられる人数は次のように推移していく\n\n    start  1回目   2回目  3回目\n　　*****************************\n     7人    1人     1人    1人\n            2人     2人    2人\n            3人     3人    3人\n            7人     7人    7人\n    \"\"\"\n\n```\n\nたとえば7人で一連のゲームを始めるとします。まず1回目の少数決の結果、残る人数は1人・2人・3人・7人のどれかに決まります。1人と2人の場合、ルール上ゲームが終わってしまうので、2回目の少数決の対象になるのは3人もしくは7人の場合です。\n\n3人で少数決を行うと、残る人数は1人もしくは3人です。7人の場合は言うまでもなく、1人・2人・3人・7人のどれかです。つまり7人で始めたゲームについて、2回の少数決を行ったとき、残る人数の組み合わせは1人・2人・3人・7人に決まります。\n\nわたしの解法は以上のような手続き(?)を模したものといえます。___つまり少数決を1回1回進めながら、残った人数について確率を求め、それをもとに期待値を計算しているのです。___あるいは少数決の回数を重ねながら、期待値を正解に近づけていく解き方と言い換えることができるかもしれません。\n\nこの解法の問題は「終わりがない」ということ。少数決の回数はいくらでも増やすことができるので、どこかのタイミングでゲームを中断してやる必要があります。そこで今回は___期待値に変動がなくなった時点で、十分正解に近づいたと判断し、ゲームを中断することにしました。___\n\n*** \n\n1. 疲れた身体で書いているせいか、解法の説明がポエムみたいになっています(´・ω・`)\n2. これを解いていた当時は再帰に凝っていたらしく、コード全体が(メモ化)再帰まみれ(´・ω・`)\n3. 社会人になって3か月も経ってないのに、もうつらい(´・ω・`)\n\n","coediting":false,"comments_count":0,"created_at":"2016-06-16T19:58:24+09:00","group":null,"id":"3ac942c2c5b7251ea973","likes_count":0,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"codeiq","versions":[]},{"name":"Python3","versions":[]}],"title":"CodeIQ「『マイナー・ゲーム』問題」に挑戦しました。","updated_at":"2016-06-16T19:58:24+09:00","url":"https://qiita.com/neko_the_shadow/items/3ac942c2c5b7251ea973","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":36,"github_login_name":null,"id":"neko_the_shadow","items_count":214,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":935,"team_membership":null,"organization_url_name":null}