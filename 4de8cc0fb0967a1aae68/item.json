{"rendered_body":"<p>先日次のような記事を書きました: <a href=\"http://qiita.com/neko_the_shadow/items/4ebad619564a48f5a97f\" id=\"reference-600a44c038260daabfed\">「Pythonで素数列挙と素数判定」</a>。これを公開したのち、ふと「素数の無限ジェネレータ」をPython3を作ったので、Qiitaに公開しておきます(実用性には乏しいと思いますが……)</p>\n\n<p>ポイントは<code>itertools.count</code>と<code>functools.partial</code>あたりでしょうか。前者は整数の無限ストリームを作り、後者はメソッド(関数)に対する部分適用を実現しています。</p>\n\n<div class=\"code-frame\" data-lang=\"py3\"><div class=\"highlight\"><pre><code>\n<span class=\"kn\">import</span> <span class=\"nn\">itertools</span><span class=\"p\">,</span> <span class=\"n\">functools</span><span class=\"p\">,</span> <span class=\"n\">math</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">prime_stream</span><span class=\"p\">():</span>\n    <span class=\"n\">stream</span> <span class=\"o\">=</span> <span class=\"n\">itertools</span><span class=\"p\">.</span><span class=\"n\">count</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n    <span class=\"n\">sieve</span> <span class=\"o\">=</span> <span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">:</span> <span class=\"n\">x</span> <span class=\"o\">%</span> <span class=\"n\">y</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span>\n\n    <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>\n        <span class=\"n\">prime</span> <span class=\"o\">=</span> <span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"n\">stream</span><span class=\"p\">)</span>\n        <span class=\"n\">stream</span> <span class=\"o\">=</span> <span class=\"nb\">filter</span><span class=\"p\">(</span><span class=\"n\">functools</span><span class=\"p\">.</span><span class=\"n\">partial</span><span class=\"p\">(</span><span class=\"n\">sieve</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"n\">prime</span><span class=\"p\">),</span> <span class=\"n\">stream</span><span class=\"p\">)</span>\n        <span class=\"k\">yield</span> <span class=\"n\">prime</span>\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span> <span class=\"o\">==</span> <span class=\"s\">'__main__'</span><span class=\"p\">:</span>\n    <span class=\"n\">primes</span> <span class=\"o\">=</span> <span class=\"n\">prime_stream</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">20</span><span class=\"p\">):</span> <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"n\">primes</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># 2\n# 3\n# 5\n# 7\n# 11\n# 13\n# 17\n# 19\n# 23\n# 29\n# 31\n# 37\n# 41\n# 43\n# 47\n# 53\n# 59\n# 61\n# 67\n# 71\n</span></code></pre></div></div>\n","body":"先日次のような記事を書きました: [「Pythonで素数列挙と素数判定」](http://qiita.com/neko_the_shadow/items/4ebad619564a48f5a97f)。これを公開したのち、ふと「素数の無限ジェネレータ」をPython3を作ったので、Qiitaに公開しておきます(実用性には乏しいと思いますが……)\n\nポイントは`itertools.count`と`functools.partial`あたりでしょうか。前者は整数の無限ストリームを作り、後者はメソッド(関数)に対する部分適用を実現しています。\n\n```py3\n\nimport itertools, functools, math\n\ndef prime_stream():\n    stream = itertools.count(2)\n    sieve = lambda x, y: x % y != 0\n\n    while True:\n        prime = next(stream)\n        stream = filter(functools.partial(sieve, y=prime), stream)\n        yield prime\n\nif __name__ == '__main__':\n    primes = prime_stream()\n    for _ in range(20): print(next(primes))\n    \n# 2\n# 3\n# 5\n# 7\n# 11\n# 13\n# 17\n# 19\n# 23\n# 29\n# 31\n# 37\n# 41\n# 43\n# 47\n# 53\n# 59\n# 61\n# 67\n# 71\n```\n","coediting":false,"comments_count":0,"created_at":"2016-07-27T22:57:49+09:00","group":null,"id":"4de8cc0fb0967a1aae68","likes_count":15,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"Python3","versions":[]}],"title":"Python3で素数の無限ジェネレータ","updated_at":"2016-07-27T22:57:49+09:00","url":"https://qiita.com/neko_the_shadow/items/4de8cc0fb0967a1aae68","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":36,"github_login_name":null,"id":"neko_the_shadow","items_count":199,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":null,"team_membership":null}