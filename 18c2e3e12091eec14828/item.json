{"rendered_body":"<p>通算10000回は調べているので、いい加減にまとめておきます(大げさ)。なお以下のSQLはDb2 on Cloudで稼働確認を行いました。おそらくDb2 LUW V10.5やV11でも動くと思います。zOSはわかりません(´・ω・｀)</p>\n\n<h2>\n<span id=\"timestamp文字列\" class=\"fragment\"></span><a href=\"#timestamp%E6%96%87%E5%AD%97%E5%88%97\"><i class=\"fa fa-link\"></i></a>TIMESTAMP→文字列</h2>\n\n<p>まずtimestampから文字列に変換する場合は<code>VARCHAR_FORMAT</code>もしくは<code>TO_CHAR</code>を利用します。フォーマット指定子は以下に示す<code>VARCHAR_FORMAT</code>のIBM Knowledge Centerに一覧が記載されています。</p>\n\n<ul>\n<li>\n<code>VARCHAR_FORMAT</code>: <a href=\"https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007110.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007110.html</a>\n</li>\n<li>\n<code>TO_CHAR</code>: <a href=\"https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007108.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007108.html</a>\n</li>\n</ul>\n\n<p>例えば以下の2つのSQLは両方とも<code>2018/12/29 16:52:49</code>というような結果を返します。</p>\n\n<div class=\"code-frame\" data-lang=\"sql\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"k\">SELECT</span> <span class=\"n\">TO_CHAR</span><span class=\"p\">(</span><span class=\"k\">current</span> <span class=\"nb\">timestamp</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD HH24:MI:SS'</span><span class=\"p\">)</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">VARCHAR_FORMAT</span><span class=\"p\">(</span><span class=\"k\">current</span> <span class=\"nb\">timestamp</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD HH24:MI:SS'</span><span class=\"p\">)</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span>\n</code></pre></div></div>\n\n<h2>\n<span id=\"文字列timestamp\" class=\"fragment\"></span><a href=\"#%E6%96%87%E5%AD%97%E5%88%97timestamp\"><i class=\"fa fa-link\"></i></a>文字列→TIMESTAMP</h2>\n\n<p>次に文字列をパースしてTIMESTAMPに変換したい場合は<code>TIMESTAMP_FORMAT</code>もしくは<code>TO_DATE</code>を利用します。第2引数にはフォーマット形式を指定しますが、ここで利用できるフォーマット指定子は<code>TIMESTAMP_FORMAT</code>のIBM Knowledge Centerに記載されています。</p>\n\n<ul>\n<li>\n<code>TIMESTAMP_FORMAT</code>: <a href=\"https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007107.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007107.html</a>\n</li>\n<li>\n<code>TO_DATE</code>: <a href=\"https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007109.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007109.html</a>\n</li>\n</ul>\n\n<p>以下に示す2つのSQLは<code>2018/12/30</code>という文字列をTIMESTAMPにパースするサンプルで、どちらも<code>2018-12-30 00:00:00.0</code>という結果を得ることができるはずです。</p>\n\n<div class=\"code-frame\" data-lang=\"sql\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TIMESTAMP_FORMAT</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span>\n</code></pre></div></div>\n\n<h2>\n<span id=\"算術計算\" class=\"fragment\"></span><a href=\"#%E7%AE%97%E8%A1%93%E8%A8%88%E7%AE%97\"><i class=\"fa fa-link\"></i></a>算術計算</h2>\n\n<p>Db2では日付の算術計算をサポートしており、<code>+ 1 hours</code>などのように「演算子→数値→単位」形式で可能になっています--と書くとややこしいですね(´・ω・｀) これについてはサンプルを見てもらったほうが早いと思います。以下のサンプルは2018/12/30に1年・1か月・1日・1時間・1分・1秒をそれぞれ足し算するもので、それぞれのSQLの結果はコメントで示しています。</p>\n\n<div class=\"code-frame\" data-lang=\"sql\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">years</span>   <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2019-12-30 00:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">months</span>  <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2019-01-30 00:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">days</span>    <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-12-31 00:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">hours</span>   <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-12-30 01:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">minutes</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-12-30 00:01:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"n\">seconds</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-12-30 00:00:01.0</span>\n</code></pre></div></div>\n\n<p>引き算ももちろん可能です。</p>\n\n<div class=\"code-frame\" data-lang=\"sql\"><div class=\"highlight\"><pre class=\"with-code\"><code><span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"mi\">100</span> <span class=\"n\">years</span>  <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 1918-12-30 00:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"mi\">100</span> <span class=\"n\">months</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2010-08-30 00:00:00.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"mi\">100</span> <span class=\"n\">days</span>   <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-09-21 00:00:00.0</span>\n</code></pre></div></div>\n\n<p>最後に複数の日時を足したり引いたりする例を示します。結構複雑な計算も可能ですが、ここまでくるとSQLではなくアプリ側で計算したほうがよさそうですね(´・ω・｀)</p>\n\n<div class=\"code-frame\" data-lang=\"sql\"><div class=\"highlight\"><pre class=\"with-code\"><code>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">10</span> <span class=\"n\">hours</span> <span class=\"o\">-</span> <span class=\"mi\">10</span> <span class=\"n\">minutes</span> <span class=\"o\">+</span> <span class=\"mi\">10</span> <span class=\"n\">seconds</span> <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2018-12-30 09:50:10.0</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">TO_DATE</span><span class=\"p\">(</span><span class=\"s1\">'2018/12/30'</span><span class=\"p\">,</span> <span class=\"s1\">'YYYY/MM/DD'</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">10</span> <span class=\"n\">years</span> <span class=\"o\">-</span> <span class=\"mi\">10</span> <span class=\"n\">months</span>  <span class=\"o\">+</span> <span class=\"mi\">10</span> <span class=\"n\">days</span>    <span class=\"k\">FROM</span> <span class=\"n\">SYSIBM</span><span class=\"p\">.</span><span class=\"n\">SYSDUMMY1</span><span class=\"p\">;</span> <span class=\"c1\">-- 2028-03-10 00:00:00.0</span>\n</code></pre></div></div>\n","body":"通算10000回は調べているので、いい加減にまとめておきます(大げさ)。なお以下のSQLはDb2 on Cloudで稼働確認を行いました。おそらくDb2 LUW V10.5やV11でも動くと思います。zOSはわかりません(´・ω・｀)\n\n## TIMESTAMP→文字列\n\nまずtimestampから文字列に変換する場合は`VARCHAR_FORMAT`もしくは`TO_CHAR`を利用します。フォーマット指定子は以下に示す`VARCHAR_FORMAT`のIBM Knowledge Centerに一覧が記載されています。\n\n- `VARCHAR_FORMAT`: https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007110.html\n- `TO_CHAR`: https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007108.html\n\n例えば以下の2つのSQLは両方とも`2018/12/29 16:52:49`というような結果を返します。\n\n```sql\nSELECT TO_CHAR(current timestamp, 'YYYY/MM/DD HH24:MI:SS') FROM SYSIBM.SYSDUMMY1;\nSELECT VARCHAR_FORMAT(current timestamp, 'YYYY/MM/DD HH24:MI:SS') FROM SYSIBM.SYSDUMMY1;\n```\n\n## 文字列→TIMESTAMP\n\n次に文字列をパースしてTIMESTAMPに変換したい場合は`TIMESTAMP_FORMAT`もしくは`TO_DATE`を利用します。第2引数にはフォーマット形式を指定しますが、ここで利用できるフォーマット指定子は`TIMESTAMP_FORMAT`のIBM Knowledge Centerに記載されています。\n\n- `TIMESTAMP_FORMAT`: https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007107.html\n- `TO_DATE`: https://www.ibm.com/support/knowledgecenter/ja/SSEPGG_11.1.0/com.ibm.db2.luw.sql.ref.doc/doc/r0007109.html\n\n以下に示す2つのSQLは`2018/12/30`という文字列をTIMESTAMPにパースするサンプルで、どちらも`2018-12-30 00:00:00.0`という結果を得ることができるはずです。\n\n```sql\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') FROM SYSIBM.SYSDUMMY1;\nSELECT TIMESTAMP_FORMAT('2018/12/30', 'YYYY/MM/DD') FROM SYSIBM.SYSDUMMY1;\n```\n\n## 算術計算\n\nDb2では日付の算術計算をサポートしており、`+ 1 hours`などのように「演算子→数値→単位」形式で可能になっています--と書くとややこしいですね(´・ω・｀) これについてはサンプルを見てもらったほうが早いと思います。以下のサンプルは2018/12/30に1年・1か月・1日・1時間・1分・1秒をそれぞれ足し算するもので、それぞれのSQLの結果はコメントで示しています。\n\n```sql\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 years   FROM SYSIBM.SYSDUMMY1; -- 2019-12-30 00:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 months  FROM SYSIBM.SYSDUMMY1; -- 2019-01-30 00:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 days    FROM SYSIBM.SYSDUMMY1; -- 2018-12-31 00:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 hours   FROM SYSIBM.SYSDUMMY1; -- 2018-12-30 01:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 minutes FROM SYSIBM.SYSDUMMY1; -- 2018-12-30 00:01:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 1 seconds FROM SYSIBM.SYSDUMMY1; -- 2018-12-30 00:00:01.0\n```\n\n引き算ももちろん可能です。\n\n```sql\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') - 100 years  FROM SYSIBM.SYSDUMMY1; -- 1918-12-30 00:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') - 100 months FROM SYSIBM.SYSDUMMY1; -- 2010-08-30 00:00:00.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') - 100 days   FROM SYSIBM.SYSDUMMY1; -- 2018-09-21 00:00:00.0\n```\n\n最後に複数の日時を足したり引いたりする例を示します。結構複雑な計算も可能ですが、ここまでくるとSQLではなくアプリ側で計算したほうがよさそうですね(´・ω・｀)\n\n```sql\n\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 10 hours - 10 minutes + 10 seconds FROM SYSIBM.SYSDUMMY1; -- 2018-12-30 09:50:10.0\nSELECT TO_DATE('2018/12/30', 'YYYY/MM/DD') + 10 years - 10 months  + 10 days    FROM SYSIBM.SYSDUMMY1; -- 2028-03-10 00:00:00.0\n```\n","coediting":false,"comments_count":0,"created_at":"2018-12-31T23:33:56+09:00","group":null,"id":"18c2e3e12091eec14828","likes_count":9,"private":false,"reactions_count":0,"tags":[{"name":"db2","versions":[]}],"title":"Db2でTIMESTAMP⇔文字列変換 & TIMESTAMPの算術計算","updated_at":"2019-01-01T11:07:44+09:00","url":"https://qiita.com/neko_the_shadow/items/18c2e3e12091eec14828","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":36,"github_login_name":null,"id":"neko_the_shadow","items_count":191,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":null,"team_membership":null}