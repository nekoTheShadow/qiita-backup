{"rendered_body":"<p><em>注意: Rubyのバージョンは2.3.0です。それ以前のバージョンあるいはそれ以後のバージョンでは挙動が変化している可能性があります。</em></p>\n\n<p><code>reduce</code>または<code>inject</code>による畳み込み演算の途中で処理を抜けたい場合は<code>break</code>を利用します。このとき<strong><code>reduce/inject</code>の戻り値にしたい値を<code>break</code>の引数に渡す</strong>ことが重要です。</p>\n\n<div class=\"code-frame\" data-lang=\"irb\"><div class=\"highlight\"><pre><span class=\"gp\">irb(main):001:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span> <span class=\"o\">=</span> <span class=\"sx\">%w(ruby perl python php java)</span>\n<span class=\"p\">=&gt;</span> <span class=\"p\">[</span><span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span> <span class=\"s2\">\"perl\"</span><span class=\"p\">,</span> <span class=\"s2\">\"python\"</span><span class=\"p\">,</span> <span class=\"s2\">\"php\"</span><span class=\"p\">,</span> <span class=\"s2\">\"java\"</span><span class=\"p\">]</span>\n<span class=\"gp\">irb(main):002:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span><span class=\"p\">.</span><span class=\"nf\">reduce</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">str</span><span class=\"p\">,</span> <span class=\"n\">lang</span><span class=\"o\">|</span>\n<span class=\"gp\">irb(main):003:1*</span><span class=\"w\">   </span><span class=\"k\">break</span> <span class=\"n\">str</span> <span class=\"k\">if</span> <span class=\"n\">lang</span><span class=\"p\">.</span><span class=\"nf\">size</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4</span>\n<span class=\"gp\">irb(main):004:1&gt;</span><span class=\"w\">   </span><span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">lang</span><span class=\"si\">}</span><span class=\"s2\"> / </span><span class=\"si\">#{</span><span class=\"n\">str</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"gp\">irb(main):005:1&gt;</span><span class=\"w\"> </span><span class=\"k\">end</span>\n<span class=\"p\">=&gt;</span> <span class=\"s2\">\"python / perl / ruby\"</span>\n</pre></div></div>\n\n<p>なお引数なしの<code>break</code>を宣言した場合、戻り値は<code>nil</code>になります。</p>\n\n<div class=\"code-frame\" data-lang=\"irb\"><div class=\"highlight\"><pre><span class=\"gp\">irb(main):001:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span> <span class=\"o\">=</span><span class=\"sx\">%w(ruby perl python php java)</span>\n<span class=\"p\">=&gt;</span> <span class=\"p\">[</span><span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span> <span class=\"s2\">\"perl\"</span><span class=\"p\">,</span> <span class=\"s2\">\"python\"</span><span class=\"p\">,</span> <span class=\"s2\">\"php\"</span><span class=\"p\">,</span> <span class=\"s2\">\"java\"</span><span class=\"p\">]</span>\n<span class=\"gp\">irb(main):002:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span><span class=\"p\">.</span><span class=\"nf\">reduce</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">str</span><span class=\"p\">,</span> <span class=\"n\">lang</span><span class=\"o\">|</span>\n<span class=\"gp\">irb(main):003:1*</span><span class=\"w\">   </span><span class=\"k\">break</span> <span class=\"k\">if</span> <span class=\"n\">lang</span><span class=\"p\">.</span><span class=\"nf\">size</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4</span>\n<span class=\"gp\">irb(main):004:1&gt;</span><span class=\"w\">   </span><span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">lang</span><span class=\"si\">}</span><span class=\"s2\"> / </span><span class=\"si\">#{</span><span class=\"n\">str</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"gp\">irb(main):005:1&gt;</span><span class=\"w\"> </span><span class=\"k\">end</span>\n<span class=\"p\">=&gt;</span> <span class=\"kp\">nil</span>\n</pre></div></div>\n\n<p>さて上のようなケースでは三項演算子を利用したいところです。<strong>三項演算子の真式もしくは偽式に<code>break</code>を利用する場合はbreakを<code>(break str)</code>のように書く必要があります。</strong></p>\n\n<div class=\"code-frame\" data-lang=\"irb\"><div class=\"highlight\"><pre><span class=\"gp\">irb(main):008:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span> <span class=\"o\">=</span><span class=\"sx\">%w(ruby perl python php java)</span>\n<span class=\"p\">=&gt;</span> <span class=\"p\">[</span><span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span> <span class=\"s2\">\"perl\"</span><span class=\"p\">,</span> <span class=\"s2\">\"python\"</span><span class=\"p\">,</span> <span class=\"s2\">\"php\"</span><span class=\"p\">,</span> <span class=\"s2\">\"java\"</span><span class=\"p\">]</span>\n<span class=\"gp\">irb(main):009:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span><span class=\"p\">.</span><span class=\"nf\">reduce</span><span class=\"p\">{</span><span class=\"o\">|</span><span class=\"n\">str</span><span class=\"p\">,</span> <span class=\"n\">lang</span><span class=\"o\">|</span> <span class=\"n\">lang</span><span class=\"p\">.</span><span class=\"nf\">size</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4</span> <span class=\"p\">?</span> <span class=\"p\">(</span><span class=\"k\">break</span> <span class=\"n\">str</span><span class=\"p\">)</span> <span class=\"p\">:</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">lang</span><span class=\"si\">}</span><span class=\"s2\"> / </span><span class=\"si\">#{</span><span class=\"n\">str</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">}</span>\n<span class=\"p\">=&gt;</span> <span class=\"s2\">\"python / perl / ruby\"</span>\n</pre></div></div>\n\n<p>なお<code>break</code>を<code>()</code>でくくらないと例外が発生します。</p>\n\n<div class=\"code-frame\" data-lang=\"irb\"><div class=\"highlight\"><pre><span class=\"gp\">irb(main):013:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span> <span class=\"o\">=</span> <span class=\"sx\">%w(ruby perl python php java)</span>\n<span class=\"p\">=&gt;</span> <span class=\"p\">[</span><span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span> <span class=\"s2\">\"perl\"</span><span class=\"p\">,</span> <span class=\"s2\">\"python\"</span><span class=\"p\">,</span> <span class=\"s2\">\"php\"</span><span class=\"p\">,</span> <span class=\"s2\">\"java\"</span><span class=\"p\">]</span>\n<span class=\"gp\">irb(main):014:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span><span class=\"p\">.</span><span class=\"nf\">reduce</span><span class=\"p\">{</span><span class=\"o\">|</span><span class=\"n\">str</span><span class=\"p\">,</span> <span class=\"n\">lang</span><span class=\"o\">|</span> <span class=\"n\">lang</span><span class=\"p\">.</span><span class=\"nf\">size</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4</span> <span class=\"p\">?</span> <span class=\"k\">break</span> <span class=\"n\">str</span> <span class=\"p\">:</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">lang</span><span class=\"si\">}</span><span class=\"s2\"> / </span><span class=\"si\">#{</span><span class=\"n\">str</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">}</span>\n<span class=\"gr\">SyntaxError: (irb):14: syntax error, unexpected tIDENTIFIER, expecting ':'\n...lang| lang.size &lt; 4 ? break str : \"#{lang} / #{str}\"}\n...                               ^\n</span><span class=\"gp\">        from C:/Ruby23/bin/irb.cmd:19:in `&lt;main&gt;</span><span class=\"err\">'</span>\n</pre></div></div>\n\n<p>では<code>break</code>に引数を渡さない場合はどうでしょうか? 実は<strong>例外は発生しません</strong>。</p>\n\n<div class=\"code-frame\" data-lang=\"irb\"><div class=\"highlight\"><pre><span class=\"gp\">irb(main):015:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span> <span class=\"o\">=</span> <span class=\"sx\">%w(ruby perl python php java)</span>\n<span class=\"p\">=&gt;</span> <span class=\"p\">[</span><span class=\"s2\">\"ruby\"</span><span class=\"p\">,</span> <span class=\"s2\">\"perl\"</span><span class=\"p\">,</span> <span class=\"s2\">\"python\"</span><span class=\"p\">,</span> <span class=\"s2\">\"php\"</span><span class=\"p\">,</span> <span class=\"s2\">\"java\"</span><span class=\"p\">]</span>\n<span class=\"gp\">irb(main):016:0&gt;</span><span class=\"w\"> </span><span class=\"n\">langs</span><span class=\"p\">.</span><span class=\"nf\">reduce</span><span class=\"p\">{</span><span class=\"o\">|</span><span class=\"n\">str</span><span class=\"p\">,</span> <span class=\"n\">lang</span><span class=\"o\">|</span> <span class=\"n\">lang</span><span class=\"p\">.</span><span class=\"nf\">size</span> <span class=\"o\">&lt;</span> <span class=\"mi\">4</span> <span class=\"p\">?</span> <span class=\"k\">break</span> <span class=\"p\">:</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">lang</span><span class=\"si\">}</span><span class=\"s2\"> / </span><span class=\"si\">#{</span><span class=\"n\">str</span><span class=\"si\">}</span><span class=\"s2\">\"</span><span class=\"p\">}</span>\n<span class=\"p\">=&gt;</span> <span class=\"kp\">nil</span>\n</pre></div></div>\n\n<p>このあたりのさじ加減(?)はなかなか難しいところがあります。まあ<code>break</code>や<code>reduce/inject</code>を多用するプログラミングスタイルはわかりづらいので避けるべきという話かもしれませんが(´・ω・`)</p>\n","body":"\n*注意: Rubyのバージョンは2.3.0です。それ以前のバージョンあるいはそれ以後のバージョンでは挙動が変化している可能性があります。*\n\n`reduce`または`inject`による畳み込み演算の途中で処理を抜けたい場合は`break`を利用します。このとき__`reduce/inject`の戻り値にしたい値を`break`の引数に渡す__ことが重要です。\n\n```irb\nirb(main):001:0> langs = %w(ruby perl python php java)\n=> [\"ruby\", \"perl\", \"python\", \"php\", \"java\"]\nirb(main):002:0> langs.reduce do |str, lang|\nirb(main):003:1*   break str if lang.size < 4\nirb(main):004:1>   \"#{lang} / #{str}\"\nirb(main):005:1> end\n=> \"python / perl / ruby\"\n```\n\nなお引数なしの`break`を宣言した場合、戻り値は`nil`になります。\n\n```irb\nirb(main):001:0> langs =%w(ruby perl python php java)\n=> [\"ruby\", \"perl\", \"python\", \"php\", \"java\"]\nirb(main):002:0> langs.reduce do |str, lang|\nirb(main):003:1*   break if lang.size < 4\nirb(main):004:1>   \"#{lang} / #{str}\"\nirb(main):005:1> end\n=> nil\n```\n\nさて上のようなケースでは三項演算子を利用したいところです。__三項演算子の真式もしくは偽式に`break`を利用する場合はbreakを`(break str)`のように書く必要があります。__\n\n```irb\nirb(main):008:0> langs =%w(ruby perl python php java)\n=> [\"ruby\", \"perl\", \"python\", \"php\", \"java\"]\nirb(main):009:0> langs.reduce{|str, lang| lang.size < 4 ? (break str) : \"#{lang} / #{str}\"}\n=> \"python / perl / ruby\"\n```\n\nなお`break`を`()`でくくらないと例外が発生します。\n\n```irb\nirb(main):013:0> langs = %w(ruby perl python php java)\n=> [\"ruby\", \"perl\", \"python\", \"php\", \"java\"]\nirb(main):014:0> langs.reduce{|str, lang| lang.size < 4 ? break str : \"#{lang} / #{str}\"}\nSyntaxError: (irb):14: syntax error, unexpected tIDENTIFIER, expecting ':'\n...lang| lang.size < 4 ? break str : \"#{lang} / #{str}\"}\n...                               ^\n        from C:/Ruby23/bin/irb.cmd:19:in `<main>'\n```\n\nでは`break`に引数を渡さない場合はどうでしょうか? 実は__例外は発生しません__。\n\n```irb\nirb(main):015:0> langs = %w(ruby perl python php java)\n=> [\"ruby\", \"perl\", \"python\", \"php\", \"java\"]\nirb(main):016:0> langs.reduce{|str, lang| lang.size < 4 ? break : \"#{lang} / #{str}\"}\n=> nil\n```\n\nこのあたりのさじ加減(?)はなかなか難しいところがあります。まあ`break`や`reduce/inject`を多用するプログラミングスタイルはわかりづらいので避けるべきという話かもしれませんが(´・ω・`)\n\n\n\n","coediting":false,"comments_count":1,"created_at":"2016-09-25T20:25:14+09:00","group":null,"id":"73edfc6c3a3083a67156","likes_count":3,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]}],"title":"reduce/injectで処理を中断するにはbreakを使う(+三項演算子の話)","updated_at":"2016-09-25T20:25:14+09:00","url":"https://qiita.com/neko_the_shadow/items/73edfc6c3a3083a67156","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":32,"github_login_name":null,"id":"neko_the_shadow","items_count":165,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":null}