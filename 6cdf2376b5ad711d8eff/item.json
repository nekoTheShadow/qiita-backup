{"rendered_body":"<h1 data-sourcepos=\"1:1-1:14\">\n<span id=\"はじめに\" class=\"fragment\"></span><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"><i class=\"fa fa-link\"></i></a>はじめに</h1>\n<p data-sourcepos=\"3:1-3:99\">ここ数日、コンビニ交付のシステムトラブルが世間をにぎわせています。</p>\n<p data-sourcepos=\"5:1-5:62\"><iframe id=\"qiita-embed-content__0c16e73d7cbea9a91ccd3f52144b8db5\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__0c16e73d7cbea9a91ccd3f52144b8db5\" data-content=\"https%3A%2F%2Fwww3.nhk.or.jp%2Fnews%2Fhtml%2F20230502%2Fk10014056301000.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"7:1-7:252\">この記事にある川崎市のシステムを開発したベンダーからプレスリリースがでており、その内容から「一時ファイルの不適切な取扱いが原因ではないか」とSNS上ではうわさされています。</p>\n<p data-sourcepos=\"9:1-9:79\"><iframe id=\"qiita-embed-content__aec347454dec0e611b68222de49a6823\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__aec347454dec0e611b68222de49a6823\" data-content=\"https%3A%2F%2Fwww.fujitsu.com%2Fjp%2Fgroup%2Ffjj%2Fabout%2Fresources%2Fnews%2Ftopics%2F2023%2F0509.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"11:1-11:348\">本当に一時ファイルの取り扱いが悪かったのかについては関係者しかわからないのですが、そういうSNSのやりとりを見ていて、Javaには一時ファイルを安全に作成する方法が標準で用意されていることを思い出したので、まとめておこうと思った次第です(強引)</p>\n<h1 data-sourcepos=\"13:1-13:13\">\n<span id=\"java6以前\" class=\"fragment\"></span><a href=\"#java6%E4%BB%A5%E5%89%8D\"><i class=\"fa fa-link\"></i></a>Java6以前</h1>\n<p data-sourcepos=\"15:1-15:86\">Java6以前の場合はFileクラスのcreateTempFileメソッドを利用します。</p>\n<ul data-sourcepos=\"17:1-19:0\">\n<li data-sourcepos=\"17:1-17:167\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#createTempFile-java.lang.String-java.lang.String-\" rel=\"nofollow noopener\" target=\"_blank\">File.createTempFile(String prefix, String suffix)</a></li>\n<li data-sourcepos=\"18:1-19:0\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#createTempFile-java.lang.String-java.lang.String-java.io.File-\" rel=\"nofollow noopener\" target=\"_blank\">File.createTempFile(String prefix, String suffix, File directory)</a></li>\n</ul>\n<p data-sourcepos=\"20:1-20:155\">またFileクラスの\tdeleteOnExitメソッドを利用すると、JVMの終了時に作成した一時ファイルを削除することができます。</p>\n<ul data-sourcepos=\"22:1-23:0\">\n<li data-sourcepos=\"22:1-23:0\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#deleteOnExit--\" rel=\"nofollow noopener\" target=\"_blank\">File.deleteOnExit()</a></li>\n</ul>\n<h1 data-sourcepos=\"24:1-24:13\">\n<span id=\"java7以降\" class=\"fragment\"></span><a href=\"#java7%E4%BB%A5%E9%99%8D\"><i class=\"fa fa-link\"></i></a>Java7以降</h1>\n<p data-sourcepos=\"26:1-26:99\">Java7以降の場合はFilesクラスのcreateTempFileメソッドを利用するとよいです。</p>\n<ul data-sourcepos=\"28:1-30:0\">\n<li data-sourcepos=\"28:1-28:272\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempFile-java.nio.file.Path-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...-\" rel=\"nofollow noopener\" target=\"_blank\">Files.createTempFile(Path dir, String prefix, String suffix, FileAttribute&gt;... attrs)</a></li>\n<li data-sourcepos=\"29:1-30:0\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempFile-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...-\" rel=\"nofollow noopener\" target=\"_blank\">Files.createTempFile(String prefix, String suffix, FileAttribute&gt;... attrs)</a></li>\n</ul>\n<p data-sourcepos=\"31:1-31:279\">Files.newBufferedWriterやFiles.newOutputStreamなどを使ってこの一時ファイルをオープンする際、OpenOptionとしてStndardOpenOption.DELETE_ON_CLOSEを指定すると、ファイルをクローズする際にファイルを削除することができます。</p>\n<ul data-sourcepos=\"33:1-34:0\">\n<li data-sourcepos=\"33:1-34:0\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/StandardOpenOption.html#DELETE_ON_CLOSE\" rel=\"nofollow noopener\" target=\"_blank\">StndardOpenOption.DELETE_ON_CLOSE</a></li>\n</ul>\n<p data-sourcepos=\"35:1-35:195\">またFilesクラスにはcreateTempDirectoryというメソッドも用意されています。これを利用すると、安全に一時ディレクトリを作成することができます。</p>\n<ul data-sourcepos=\"37:1-38:221\">\n<li data-sourcepos=\"37:1-37:250\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempDirectory-java.nio.file.Path-java.lang.String-java.nio.file.attribute.FileAttribute...-\" rel=\"nofollow noopener\" target=\"_blank\">Files.createTempDirectory(Path dir, String prefix, FileAttribute&gt;... attrs)</a></li>\n<li data-sourcepos=\"38:1-38:221\"><a href=\"https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempDirectory-java.lang.String-java.nio.file.attribute.FileAttribute...-\" rel=\"nofollow noopener\" target=\"_blank\">Files.createTempDirectory(String prefix, FileAttribute&gt;... attrs)</a></li>\n</ul>\n","body":"# はじめに\n\nここ数日、コンビニ交付のシステムトラブルが世間をにぎわせています。\n\nhttps://www3.nhk.or.jp/news/html/20230502/k10014056301000.html\n\nこの記事にある川崎市のシステムを開発したベンダーからプレスリリースがでており、その内容から「一時ファイルの不適切な取扱いが原因ではないか」とSNS上ではうわさされています。\n\nhttps://www.fujitsu.com/jp/group/fjj/about/resources/news/topics/2023/0509.html\n\n本当に一時ファイルの取り扱いが悪かったのかについては関係者しかわからないのですが、そういうSNSのやりとりを見ていて、Javaには一時ファイルを安全に作成する方法が標準で用意されていることを思い出したので、まとめておこうと思った次第です(強引)\n\n# Java6以前\n\nJava6以前の場合はFileクラスのcreateTempFileメソッドを利用します。\n\n- [File.createTempFile(String prefix, String suffix)](https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#createTempFile-java.lang.String-java.lang.String-)\n- [File.createTempFile(String prefix, String suffix, File directory)](https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#createTempFile-java.lang.String-java.lang.String-java.io.File-)\n\nまたFileクラスの\tdeleteOnExitメソッドを利用すると、JVMの終了時に作成した一時ファイルを削除することができます。\n\n- [File.deleteOnExit()](https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html#deleteOnExit--)\n\n# Java7以降\n\nJava7以降の場合はFilesクラスのcreateTempFileメソッドを利用するとよいです。\n\n- [Files.createTempFile(Path dir, String prefix, String suffix, FileAttribute<?>... attrs)](https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempFile-java.nio.file.Path-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...-)\n- [Files.createTempFile(String prefix, String suffix, FileAttribute<?>... attrs)](https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempFile-java.lang.String-java.lang.String-java.nio.file.attribute.FileAttribute...-)\n\nFiles.newBufferedWriterやFiles.newOutputStreamなどを使ってこの一時ファイルをオープンする際、OpenOptionとしてStndardOpenOption.DELETE_ON_CLOSEを指定すると、ファイルをクローズする際にファイルを削除することができます。\n\n- [StndardOpenOption.DELETE_ON_CLOSE](https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/StandardOpenOption.html#DELETE_ON_CLOSE)\n\nまたFilesクラスにはcreateTempDirectoryというメソッドも用意されています。これを利用すると、安全に一時ディレクトリを作成することができます。\n\n- [Files.createTempDirectory(Path dir, String prefix, FileAttribute<?>... attrs)](https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempDirectory-java.nio.file.Path-java.lang.String-java.nio.file.attribute.FileAttribute...-)\n- [Files.createTempDirectory(String prefix, FileAttribute<?>... attrs)](https://docs.oracle.com/javase/jp/8/docs/api/java/nio/file/Files.html#createTempDirectory-java.lang.String-java.nio.file.attribute.FileAttribute...-)\n","coediting":false,"comments_count":0,"created_at":"2023-05-10T21:37:18+09:00","group":null,"id":"6cdf2376b5ad711d8eff","likes_count":0,"private":false,"reactions_count":0,"stocks_count":1,"tags":[{"name":"Java","versions":[]}],"title":"Javaで安全に一時ファイルを作成したい","updated_at":"2023-05-10T21:40:09+09:00","url":"https://qiita.com/neko_the_shadow/items/6cdf2376b5ad711d8eff","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":37,"github_login_name":null,"id":"neko_the_shadow","items_count":216,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":815,"team_membership":null,"organization_url_name":null,"slide":false}