{"rendered_body":"<p data-sourcepos=\"1:1-1:97\">お仕事の休憩時間に頭の体操で作成したので、お炊き上げです(´・ω・`)</p>\n<p data-sourcepos=\"3:1-3:208\">パスカルの三角形をOracle SQLで実装しました。実用性は正直ないです。SQLでここまでできるとも言えますし、こんなSQLを書いてはいけませんともいえます。</p>\n<p data-sourcepos=\"5:1-5:52\">なお環境はOracle Database 19cになります。</p>\n<div class=\"code-frame\" data-lang=\"SQL\" data-sourcepos=\"7:1-32:3\"><div class=\"highlight\"><pre><code><span class=\"k\">WITH</span>\n<span class=\"n\">seq</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"p\">(</span>\n    <span class=\"k\">SELECT</span> <span class=\"mi\">1</span> <span class=\"k\">FROM</span> <span class=\"n\">DUAL</span>\n  <span class=\"k\">UNION</span> <span class=\"k\">ALL</span>\n    <span class=\"k\">SELECT</span> <span class=\"n\">n</span><span class=\"o\">+</span><span class=\"mi\">1</span> <span class=\"k\">FROM</span> <span class=\"n\">seq</span> <span class=\"k\">WHERE</span> <span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">10</span>\n<span class=\"p\">),</span>\n<span class=\"n\">triangle</span> <span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">vals</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"p\">(</span>\n      <span class=\"k\">SELECT</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">',1,'</span> <span class=\"k\">FROM</span> <span class=\"n\">DUAL</span>\n    <span class=\"k\">UNION</span> <span class=\"k\">ALL</span>\n      <span class=\"k\">SELECT</span> \n        <span class=\"n\">x</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n        <span class=\"p\">(</span><span class=\"k\">SELECT</span> <span class=\"s1\">','</span> <span class=\"o\">||</span> <span class=\"n\">LISTAGG</span><span class=\"p\">(</span>\n           <span class=\"k\">CASE</span> <span class=\"k\">WHEN</span> <span class=\"n\">n</span><span class=\"o\">=</span><span class=\"mi\">1</span> <span class=\"k\">OR</span> <span class=\"n\">n</span><span class=\"o\">=</span><span class=\"n\">x</span><span class=\"o\">+</span><span class=\"mi\">1</span> <span class=\"k\">THEN</span>\n             <span class=\"s1\">'1'</span>\n           <span class=\"k\">ELSE</span>\n             <span class=\"n\">TO_CHAR</span><span class=\"p\">(</span>  <span class=\"n\">TO_NUMBER</span><span class=\"p\">(</span><span class=\"n\">SUBSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span>  <span class=\"o\">-</span><span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">))</span>\n                     <span class=\"o\">+</span> <span class=\"n\">TO_NUMBER</span><span class=\"p\">(</span><span class=\"n\">SUBSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span>  <span class=\"p\">)</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"n\">INSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span>  <span class=\"p\">)</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)))</span>\n           <span class=\"k\">END</span><span class=\"p\">,</span> <span class=\"s1\">','</span><span class=\"p\">)</span> <span class=\"n\">WITHIN</span> <span class=\"k\">GROUP</span><span class=\"p\">(</span><span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">n</span><span class=\"p\">)</span> <span class=\"o\">||</span> <span class=\"s1\">','</span> \n         <span class=\"k\">FROM</span> <span class=\"n\">seq</span>\n         <span class=\"k\">WHERE</span> <span class=\"n\">n</span> <span class=\"o\">&lt;=</span> <span class=\"n\">x</span><span class=\"o\">+</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n      <span class=\"k\">FROM</span> <span class=\"n\">triangle</span>\n      <span class=\"k\">WHERE</span> <span class=\"n\">x</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">10</span>\n<span class=\"p\">)</span>\n<span class=\"k\">SELECT</span> <span class=\"n\">SUBSTR</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"k\">LENGTH</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">)</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"k\">AS</span> <span class=\"nv\">\" Pascal's triangle\"</span> <span class=\"k\">FROM</span> <span class=\"n\">triangle</span> <span class=\"k\">ORDER</span> <span class=\"k\">BY</span> <span class=\"n\">x</span><span class=\"p\">;</span>\n</code></pre></div></div>\n<p data-sourcepos=\"34:1-34:39\">実行結果は以下の通りです。</p>\n<table data-sourcepos=\"36:1-48:37\">\n<thead>\n<tr data-sourcepos=\"36:1-36:19\">\n<th style=\"text-align: left\" data-sourcepos=\"36:2-36:18\">Pascal's triangle</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"38:1-38:3\">\n<td style=\"text-align: left\" data-sourcepos=\"38:2-38:2\">1</td>\n</tr>\n<tr data-sourcepos=\"39:1-39:5\">\n<td style=\"text-align: left\" data-sourcepos=\"39:2-39:4\">1,1</td>\n</tr>\n<tr data-sourcepos=\"40:1-40:7\">\n<td style=\"text-align: left\" data-sourcepos=\"40:2-40:6\">1,2,1</td>\n</tr>\n<tr data-sourcepos=\"41:1-41:9\">\n<td style=\"text-align: left\" data-sourcepos=\"41:2-41:8\">1,3,3,1</td>\n</tr>\n<tr data-sourcepos=\"42:1-42:11\">\n<td style=\"text-align: left\" data-sourcepos=\"42:2-42:10\">1,4,6,4,1</td>\n</tr>\n<tr data-sourcepos=\"43:1-43:15\">\n<td style=\"text-align: left\" data-sourcepos=\"43:2-43:14\">1,5,10,10,5,1</td>\n</tr>\n<tr data-sourcepos=\"44:1-44:18\">\n<td style=\"text-align: left\" data-sourcepos=\"44:2-44:17\">1,6,15,20,15,6,1</td>\n</tr>\n<tr data-sourcepos=\"45:1-45:21\">\n<td style=\"text-align: left\" data-sourcepos=\"45:2-45:20\">1,7,21,35,35,21,7,1</td>\n</tr>\n<tr data-sourcepos=\"46:1-46:24\">\n<td style=\"text-align: left\" data-sourcepos=\"46:2-46:23\">1,8,28,56,70,56,28,8,1</td>\n</tr>\n<tr data-sourcepos=\"47:1-47:29\">\n<td style=\"text-align: left\" data-sourcepos=\"47:2-47:28\">1,9,36,84,126,126,84,36,9,1</td>\n</tr>\n<tr data-sourcepos=\"48:1-48:37\">\n<td style=\"text-align: left\" data-sourcepos=\"48:2-48:36\">1,10,45,120,210,252,210,120,45,10,1</td>\n</tr>\n</tbody>\n</table>\n","body":"お仕事の休憩時間に頭の体操で作成したので、お炊き上げです(´・ω・`)\n\nパスカルの三角形をOracle SQLで実装しました。実用性は正直ないです。SQLでここまでできるとも言えますし、こんなSQLを書いてはいけませんともいえます。\n\nなお環境はOracle Database 19cになります。\n\n```SQL\nWITH\nseq (n) AS (\n    SELECT 1 FROM DUAL\n  UNION ALL\n    SELECT n+1 FROM seq WHERE n <= 10\n),\ntriangle (x, vals) AS (\n      SELECT 1, ',1,' FROM DUAL\n    UNION ALL\n      SELECT \n        x+1,\n        (SELECT ',' || LISTAGG(\n           CASE WHEN n=1 OR n=x+1 THEN\n             '1'\n           ELSE\n             TO_CHAR(  TO_NUMBER(SUBSTR(vals, INSTR(vals, ',', 1, n-1)+1, INSTR(vals, ',', 1, n)  -INSTR(vals, ',', 1, n-1)-1))\n                     + TO_NUMBER(SUBSTR(vals, INSTR(vals, ',', 1, n  )+1, INSTR(vals, ',', 1, n+1)-INSTR(vals, ',', 1, n  )-1)))\n           END, ',') WITHIN GROUP(ORDER BY n) || ',' \n         FROM seq\n         WHERE n <= x+1)\n      FROM triangle\n      WHERE x <= 10\n)\nSELECT SUBSTR(vals, 2, LENGTH(vals)-2) AS \" Pascal's triangle\" FROM triangle ORDER BY x;\n```\n\n実行結果は以下の通りです。\n\n|Pascal's triangle|\n|:-|\n|1|\n|1,1|\n|1,2,1|\n|1,3,3,1|\n|1,4,6,4,1|\n|1,5,10,10,5,1|\n|1,6,15,20,15,6,1|\n|1,7,21,35,35,21,7,1|\n|1,8,28,56,70,56,28,8,1|\n|1,9,36,84,126,126,84,36,9,1|\n|1,10,45,120,210,252,210,120,45,10,1|\n\n","coediting":false,"comments_count":0,"created_at":"2023-09-09T18:09:26+09:00","group":null,"id":"866e328c63b2d0cb614f","likes_count":0,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"SQL","versions":[]},{"name":"oracle","versions":[]}],"title":"パスカルの三角形をOracle SQLで実装した","updated_at":"2023-09-09T18:09:26+09:00","url":"https://qiita.com/neko_the_shadow/items/866e328c63b2d0cb614f","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":38,"github_login_name":"nekoTheShadow","id":"neko_the_shadow","items_count":224,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":262,"team_membership":null,"organization_url_name":null,"slide":false}