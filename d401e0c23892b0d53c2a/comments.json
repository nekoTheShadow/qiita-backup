[{"body":"各位: コメントありがとうございます(｀・ω・´)ｼｬｷｰﾝ\n\n@SVC34 シンプルな記事を目指したため、ついつい省略してしまったのですが、現実問題として「再帰クエリ利用の際は中断条件を設定すべき」というのはご指摘の通りです。あるいは無限ループの原因となる循環参照が起きないよう、check制約やアプリケーションのvalidationを設定する必要があると思います。\n\n@gooddoog ナイーブツリーを避ける理由としては「親もしくは子を再帰的に取得するのがつらい」「枝の付け替えなど、ちょっとこったことをしようとすると、途端に複雑化する」のふたつがあげられることが多いように思います。ただ前者は再帰クエリがある環境では無問題ですし、後者にしても「凝ったこと」を行わないことがあらかじめ明らかならば、アンチパターンを上回るだけのメリットがナイーブツリーにはあると個人的には考えています。なんにせよメリットデメリットは存在するので、それをうまく見極める必要がありそうです(その見極めが難しいといえばその通りなのですが……)\n\n@yancya 「MySQLにもwithが導入される」とはまったく知りませんでした……。ご指摘ありがとうございます。ふだんはDB2とPostgreSQLを利用する機会が多く、MySQLについては手が回らないことが多いので、とても参考になりました。\n","created_at":"2017-01-11T22:31:06+09:00","id":"80cc36534ad08c97b2c5","rendered_body":"<p>各位: コメントありがとうございます(｀・ω・´)ｼｬｷｰﾝ</p>\n\n<p><a href=\"/SVC34\" class=\"user-mention js-hovercard\" title=\"SVC34\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"SVC34\">@SVC34</a> シンプルな記事を目指したため、ついつい省略してしまったのですが、現実問題として「再帰クエリ利用の際は中断条件を設定すべき」というのはご指摘の通りです。あるいは無限ループの原因となる循環参照が起きないよう、check制約やアプリケーションのvalidationを設定する必要があると思います。</p>\n\n<p><a href=\"/gooddoog\" class=\"user-mention js-hovercard\" title=\"gooddoog\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"gooddoog\">@gooddoog</a> ナイーブツリーを避ける理由としては「親もしくは子を再帰的に取得するのがつらい」「枝の付け替えなど、ちょっとこったことをしようとすると、途端に複雑化する」のふたつがあげられることが多いように思います。ただ前者は再帰クエリがある環境では無問題ですし、後者にしても「凝ったこと」を行わないことがあらかじめ明らかならば、アンチパターンを上回るだけのメリットがナイーブツリーにはあると個人的には考えています。なんにせよメリットデメリットは存在するので、それをうまく見極める必要がありそうです(その見極めが難しいといえばその通りなのですが……)</p>\n\n<p><a href=\"/yancya\" class=\"user-mention js-hovercard\" title=\"yancya\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"yancya\">@yancya</a> 「MySQLにもwithが導入される」とはまったく知りませんでした……。ご指摘ありがとうございます。ふだんはDB2とPostgreSQLを利用する機会が多く、MySQLについては手が回らないことが多いので、とても参考になりました。</p>\n","updated_at":"2017-01-11T22:31:06+09:00","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":35,"github_login_name":null,"id":"neko_the_shadow","items_count":186,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"}},{"body":"> なおMySQLのように「再帰クエリ」をサポートしていないDBMSを利用している場合は――あきらめましょう(´・ω・｀) とはいえ「再帰クエリ」は標準SQLの反中なので、将来的サポートされる可能性が高い構文ではあります。\n\nきたる MySQL 8.0 には WITH（もちろん再帰も）の機能が追加されますので、楽しみですね\n","created_at":"2017-01-11T10:33:54+09:00","id":"9ab64f97e4c429cf95a3","rendered_body":"<blockquote>\n<p>なおMySQLのように「再帰クエリ」をサポートしていないDBMSを利用している場合は――あきらめましょう(´・ω・｀) とはいえ「再帰クエリ」は標準SQLの反中なので、将来的サポートされる可能性が高い構文ではあります。</p>\n</blockquote>\n\n<p>きたる MySQL 8.0 には WITH（もちろん再帰も）の機能が追加されますので、楽しみですね</p>\n","updated_at":"2017-01-11T10:33:54+09:00","user":{"description":"","facebook_id":"","followees_count":84,"followers_count":110,"github_login_name":"yancya","id":"yancya","items_count":33,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":9513,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/9513/profile-images/1473681433","team_only":false,"twitter_screen_name":"yancya","website_url":"http://upec.jp"}},{"body":">このような構造のテーブルはナイーブツリー(Naive Tree)などと呼ばれ、有名なアンチパターンのひとつ\n\nこれアンチパターンだったんですね...\n再帰のリレーションは応用情報技術者試験の過去問で見かけたのを良いことにドヤ顔で使ってました\n結果、O/Rマッパで作ったオブジェクトが親子で循環参照してたりで散々な目にあいました。無知は罪ですね。\n","created_at":"2017-01-11T00:51:03+09:00","id":"104bb48105d6b6a09484","rendered_body":"<blockquote>\n<p>このような構造のテーブルはナイーブツリー(Naive Tree)などと呼ばれ、有名なアンチパターンのひとつ</p>\n</blockquote>\n\n<p>これアンチパターンだったんですね...<br>\n再帰のリレーションは応用情報技術者試験の過去問で見かけたのを良いことにドヤ顔で使ってました<br>\n結果、O/Rマッパで作ったオブジェクトが親子で循環参照してたりで散々な目にあいました。無知は罪ですね。</p>\n","updated_at":"2017-01-11T00:51:03+09:00","user":{"description":"ネットワーク,テスト,javascript,dbなどを勉強中","facebook_id":"","followees_count":257,"followers_count":61,"github_login_name":"yuyabu","id":"gooddoog","items_count":33,"linkedin_id":"","location":"Tokyo,Japan","name":"","organization":"","permanent_id":155509,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/155509/profile-images/1513903921","team_only":false,"twitter_screen_name":"yuyabu2","website_url":"http://yuyubu.hatenablog.com"}},{"body":"再帰クエリを使う時は無限ループが生じないように、一定の深さで処理を中断する条件を設定しておくとよいです。\n","created_at":"2017-01-11T00:20:36+09:00","id":"fe254c1ef354349f0b2f","rendered_body":"<p>再帰クエリを使う時は無限ループが生じないように、一定の深さで処理を中断する条件を設定しておくとよいです。</p>\n","updated_at":"2017-01-11T00:20:36+09:00","user":{"description":null,"facebook_id":null,"followees_count":33,"followers_count":32,"github_login_name":null,"id":"SVC34","items_count":22,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":150535,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/150535/profile-images/1481039306","team_only":false,"twitter_screen_name":null,"website_url":null}}]