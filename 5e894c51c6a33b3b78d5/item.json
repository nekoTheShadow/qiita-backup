{"rendered_body":"<p data-sourcepos=\"1:1-1:178\">「詳しくは下のドキュメントを読んでね!!!以上!!!!」という内容ですが、お仕事ではまった内容なので、個人的にメモしておきます。</p>\n<p data-sourcepos=\"3:1-3:135\"><iframe id=\"qiita-embed-content__f6520843d425d524809fb33ec45c85b9\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__f6520843d425d524809fb33ec45c85b9\" data-content=\"https%3A%2F%2Fsupport.microsoft.com%2Fen-us%2Ftopic%2Finf-how-sql-server-compares-strings-with-trailing-spaces-b62b1a2d-27d3-4260-216d-a605719003b0\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"5:1-5:238\">このドキュメントにもある通り、SQLServerでは、特別に設定をしない限り、末尾の空白はトリムされたものとして、文字列比較をします。たとえば、以下の比較はTRUEとなります。</p>\n<div class=\"code-frame\" data-lang=\"SQL\" data-sourcepos=\"7:1-9:3\"><div class=\"highlight\"><pre><code><span class=\"s1\">'AAA'</span> <span class=\"o\">=</span> <span class=\"s1\">'AAA   '</span>\n</code></pre></div></div>\n<p data-sourcepos=\"11:1-11:242\">ここで注意したいのは、いわゆる空文字と空白文字だけの文字列が同じとして扱われることです。たとえば、以下はスペース5文字と空文字を比較したものですが、これはTRUEです。</p>\n<div class=\"code-frame\" data-lang=\"SQL\" data-sourcepos=\"13:1-15:3\"><div class=\"highlight\"><pre><code><span class=\"s1\">'     '</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n</code></pre></div></div>\n<p data-sourcepos=\"17:1-17:189\">ほとんどのシステムでこの仕様が問題にはならないと思いますが、たとえば以下のような業務上の要請がある場合、考慮が必要になります。</p>\n<ul data-sourcepos=\"19:1-21:0\">\n<li data-sourcepos=\"19:1-19:65\">空文字と空白文字で業務上の意味合いが異なる</li>\n<li data-sourcepos=\"20:1-21:0\">末尾に空白のない<code>'A'</code>と末尾に空白のある<code>'A '</code>を明確に区別したい</li>\n</ul>\n<p data-sourcepos=\"22:1-22:339\">はっきりいって、わけのわからない仕様だと思いますが、わけのわからない仕様が飛び出してくるのが、システム開発というもの。とくに古いシステムをそのままコンバージョンするような場合、何が出てきてもおかしくないので、気を付けましょう(?)</p>\n<p data-sourcepos=\"24:1-24:13\"><strong>おまけ</strong></p>\n<p data-sourcepos=\"26:1-26:245\">末尾の空白について関連した話題をあげておくと、SQLServerでよく利用される関数に<code>LEN</code>があります。これは文字列長を返す関数ですが、この関数も末尾の空白を切り捨てる仕様です。</p>\n<blockquote data-sourcepos=\"28:1-28:97\">\n<p data-sourcepos=\"28:3-28:97\">Returns the number of characters of the specified string expression, excluding trailing spaces.</p>\n</blockquote>\n<p data-sourcepos=\"30:1-30:92\"><iframe id=\"qiita-embed-content__b4c579c8be877f32a7a02e2ccd264de5\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__b4c579c8be877f32a7a02e2ccd264de5\" data-content=\"https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fsql%2Ft-sql%2Ffunctions%2Flen-transact-sql%3Fview%3Dsql-server-ver16\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"32:1-32:227\">これも空白文字や空文字については注意する必要があります。たとえば、以下は5個のスペースのみからなる文字列をLENの引数にしていますが、この結果は0になります。</p>\n<div class=\"code-frame\" data-lang=\"SQL\" data-sourcepos=\"34:1-36:3\"><div class=\"highlight\"><pre><code><span class=\"k\">SELECT</span> <span class=\"n\">LEN</span><span class=\"p\">(</span><span class=\"s1\">'     '</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"38:1-38:198\">上述したようにこの仕様は空文字や空白文字、末尾の空白に業務上の意味合いがあるシステムでは問題になることがあります。気を付けましょう(?)</p>\n","body":"「詳しくは下のドキュメントを読んでね!!!以上!!!!」という内容ですが、お仕事ではまった内容なので、個人的にメモしておきます。\n\nhttps://support.microsoft.com/en-us/topic/inf-how-sql-server-compares-strings-with-trailing-spaces-b62b1a2d-27d3-4260-216d-a605719003b0\n\nこのドキュメントにもある通り、SQLServerでは、特別に設定をしない限り、末尾の空白はトリムされたものとして、文字列比較をします。たとえば、以下の比較はTRUEとなります。\n\n```SQL\n'AAA' = 'AAA   '\n```\n\nここで注意したいのは、いわゆる空文字と空白文字だけの文字列が同じとして扱われることです。たとえば、以下はスペース5文字と空文字を比較したものですが、これはTRUEです。\n\n```SQL\n'     ' = ''\n```\n\nほとんどのシステムでこの仕様が問題にはならないと思いますが、たとえば以下のような業務上の要請がある場合、考慮が必要になります。\n\n- 空文字と空白文字で業務上の意味合いが異なる\n- 末尾に空白のない`'A'`と末尾に空白のある`'A '`を明確に区別したい\n\nはっきりいって、わけのわからない仕様だと思いますが、わけのわからない仕様が飛び出してくるのが、システム開発というもの。とくに古いシステムをそのままコンバージョンするような場合、何が出てきてもおかしくないので、気を付けましょう(?)\n\n**おまけ**\n\n末尾の空白について関連した話題をあげておくと、SQLServerでよく利用される関数に`LEN`があります。これは文字列長を返す関数ですが、この関数も末尾の空白を切り捨てる仕様です。\n\n> Returns the number of characters of the specified string expression, excluding trailing spaces.\n\nhttps://learn.microsoft.com/en-us/sql/t-sql/functions/len-transact-sql?view=sql-server-ver16\n\nこれも空白文字や空文字については注意する必要があります。たとえば、以下は5個のスペースのみからなる文字列をLENの引数にしていますが、この結果は0になります。\n\n```SQL\nSELECT LEN('     ')\n```\n\n上述したようにこの仕様は空文字や空白文字、末尾の空白に業務上の意味合いがあるシステムでは問題になることがあります。気を付けましょう(?)\n\n\n","coediting":false,"comments_count":0,"created_at":"2022-11-05T18:07:42+09:00","group":null,"id":"5e894c51c6a33b3b78d5","likes_count":1,"private":false,"reactions_count":0,"stocks_count":0,"tags":[{"name":"SQLServer","versions":[]}],"title":"SQLServerでは文字列比較の際、空白に注意する必要がある (+ おまけつき)","updated_at":"2022-11-05T18:07:42+09:00","url":"https://qiita.com/neko_the_shadow/items/5e894c51c6a33b3b78d5","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":38,"github_login_name":"nekoTheShadow","id":"neko_the_shadow","items_count":224,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://github.com/nekoTheShadow"},"page_views_count":3007,"team_membership":null,"organization_url_name":null,"slide":false}