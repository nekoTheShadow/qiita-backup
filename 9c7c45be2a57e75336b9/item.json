{"rendered_body":"<p>タスクやTODOの管理にOutlookのタスク機能をよく利用しています。基本的には自分専用なのですが、ごくまれに人に見せる機会があります。このようなときはExcelファイルにエクスポートしてやると取り回しが良く便利です。</p>\n\n<p>そういうわけで「Outlookのタスク機能からタスク一覧をエクスポートするVBA」を作りました。せっかくなのでQiitaにお焚き上げしておきたいと思います。</p>\n\n<p>まず前提として、VBAからOutlookを操作するライブラリがインポートされている必要があります。やり方としては、VBEから「ツール(T)」&gt;「参照設定(R)」を選択。「参照設定」ウィンドウで「Microsoft Outlook XX.X Object Library」にチェックをつけて「OK」を押下するだけです (<code>XX.X</code>にはバージョン番号が入ります)</p>\n\n<p>サブルーチン<code>Main</code>はOutlookからエクポートしてきたタスク情報から、変数<code>sheet</code>がしめすワークシートに書き込むものになります。書き込む情報としてはA列から順に「インデックス番号」「タイトル」「タスクの本文」「カテゴリ」「タスクの状況」になります。もちろん、これは一例に過ぎないので、ほかの情報についても取得が可能です。なお「タスクの状況」については、取得できる情報が列挙型<code>Outlook.OlTaskStatus</code>のため、これを日本語に修正する関数<code>ToDisplayName</code>も作成しています。</p>\n\n<div class=\"code-frame\" data-lang=\"vb\"><div class=\"highlight\"><pre><span class=\"k\">Sub</span> <span class=\"nf\">Main</span><span class=\"p\">()</span>\n    <span class=\"c1\">' sheet変数は目的に合わせて初期化すること</span>\n    <span class=\"k\">Dim</span> <span class=\"nv\">sheet</span> <span class=\"ow\">As</span> <span class=\"n\">Excel</span><span class=\"p\">.</span><span class=\"n\">Worksheet</span>\n\n    <span class=\"k\">Dim</span> <span class=\"nv\">tasks</span> <span class=\"ow\">As</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">Items</span>\n    <span class=\"k\">Dim</span> <span class=\"nv\">task</span> <span class=\"ow\">As</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">TaskItem</span>\n    <span class=\"k\">Dim</span> <span class=\"nv\">x</span> <span class=\"ow\">As</span> <span class=\"kt\">Integer</span>\n    <span class=\"k\">Set</span> <span class=\"n\">tasks</span> <span class=\"o\">=</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">Application</span><span class=\"p\">.</span><span class=\"n\">GetNamespace</span><span class=\"p\">(</span><span class=\"s\">\"MAPI\"</span><span class=\"p\">).</span><span class=\"n\">GetDefaultFolder</span><span class=\"p\">(</span><span class=\"n\">olFolderTasks</span><span class=\"p\">).</span><span class=\"n\">Items</span>\n    <span class=\"k\">For</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"k\">To</span> <span class=\"n\">tasks</span><span class=\"p\">.</span><span class=\"n\">Count</span>\n        <span class=\"k\">Set</span> <span class=\"n\">task</span> <span class=\"o\">=</span> <span class=\"n\">tasks</span><span class=\"p\">.</span><span class=\"n\">Item</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n\n        <span class=\"n\">sheet</span><span class=\"p\">.</span><span class=\"n\">Range</span><span class=\"p\">(</span><span class=\"s\">\"A\"</span> <span class=\"o\">&amp;</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">x</span>\n        <span class=\"n\">sheet</span><span class=\"p\">.</span><span class=\"n\">Range</span><span class=\"p\">(</span><span class=\"s\">\"B\"</span> <span class=\"o\">&amp;</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">task</span><span class=\"p\">.</span><span class=\"n\">Subject</span>\n        <span class=\"n\">sheet</span><span class=\"p\">.</span><span class=\"n\">Range</span><span class=\"p\">(</span><span class=\"s\">\"C\"</span> <span class=\"o\">&amp;</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">task</span><span class=\"p\">.</span><span class=\"n\">Body</span>\n        <span class=\"n\">sheet</span><span class=\"p\">.</span><span class=\"n\">Range</span><span class=\"p\">(</span><span class=\"s\">\"D\"</span> <span class=\"o\">&amp;</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">task</span><span class=\"p\">.</span><span class=\"n\">Categories</span>\n        <span class=\"n\">sheet</span><span class=\"p\">.</span><span class=\"n\">Range</span><span class=\"p\">(</span><span class=\"s\">\"E\"</span> <span class=\"o\">&amp;</span> <span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">ToDisplayName</span><span class=\"p\">(</span><span class=\"n\">task</span><span class=\"p\">.</span><span class=\"n\">status</span><span class=\"p\">)</span>\n    <span class=\"k\">Next</span> <span class=\"n\">x</span>\n<span class=\"k\">End</span> <span class=\"k\">Sub</span>\n\n\n<span class=\"k\">Function</span> <span class=\"nf\">ToDisplayName</span><span class=\"p\">(</span><span class=\"n\">status</span> <span class=\"ow\">As</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">)</span> <span class=\"ow\">As</span> <span class=\"kt\">String</span>\n    <span class=\"k\">Select</span> <span class=\"k\">Case</span> <span class=\"n\">status</span>\n        <span class=\"k\">Case</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">.</span><span class=\"n\">olTaskComplete</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"完了\"</span>\n        <span class=\"k\">Case</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">.</span><span class=\"n\">olTaskDeferred</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"遅延\"</span>\n        <span class=\"k\">Case</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">.</span><span class=\"n\">olTaskInProgress</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"進行中\"</span>\n        <span class=\"k\">Case</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">.</span><span class=\"n\">olTaskNotStarted</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"未着手\"</span>\n        <span class=\"k\">Case</span> <span class=\"n\">Outlook</span><span class=\"p\">.</span><span class=\"n\">OlTaskStatus</span><span class=\"p\">.</span><span class=\"n\">olTaskWaiting</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"待機中\"</span>\n        <span class=\"k\">Case</span> <span class=\"k\">Else</span>\n            <span class=\"n\">ToDisplayName</span> <span class=\"o\">=</span> <span class=\"s\">\"UNKNOWN\"</span>\n    <span class=\"k\">End</span> <span class=\"k\">Select</span>\n<span class=\"k\">End</span> <span class=\"k\">Function</span>\n\n</pre></div></div>\n","body":"タスクやTODOの管理にOutlookのタスク機能をよく利用しています。基本的には自分専用なのですが、ごくまれに人に見せる機会があります。このようなときはExcelファイルにエクスポートしてやると取り回しが良く便利です。\n\nそういうわけで「Outlookのタスク機能からタスク一覧をエクスポートするVBA」を作りました。せっかくなのでQiitaにお焚き上げしておきたいと思います。\n\nまず前提として、VBAからOutlookを操作するライブラリがインポートされている必要があります。やり方としては、VBEから「ツール(T)」>「参照設定(R)」を選択。「参照設定」ウィンドウで「Microsoft Outlook XX.X Object Library」にチェックをつけて「OK」を押下するだけです (`XX.X`にはバージョン番号が入ります)\n\nサブルーチン`Main`はOutlookからエクポートしてきたタスク情報から、変数`sheet`がしめすワークシートに書き込むものになります。書き込む情報としてはA列から順に「インデックス番号」「タイトル」「タスクの本文」「カテゴリ」「タスクの状況」になります。もちろん、これは一例に過ぎないので、ほかの情報についても取得が可能です。なお「タスクの状況」については、取得できる情報が列挙型`Outlook.OlTaskStatus`のため、これを日本語に修正する関数`ToDisplayName`も作成しています。\n\n```vb\nSub Main()\n    ' sheet変数は目的に合わせて初期化すること\n    Dim sheet As Excel.Worksheet\n    \n    Dim tasks As Outlook.Items\n    Dim task As Outlook.TaskItem\n    Dim x As Integer\n    Set tasks = Outlook.Application.GetNamespace(\"MAPI\").GetDefaultFolder(olFolderTasks).Items\n    For x = 1 To tasks.Count\n        Set task = tasks.Item(x)\n        \n        sheet.Range(\"A\" & x) = x\n        sheet.Range(\"B\" & x) = task.Subject\n        sheet.Range(\"C\" & x) = task.Body\n        sheet.Range(\"D\" & x) = task.Categories\n        sheet.Range(\"E\" & x) = ToDisplayName(task.status)\n    Next x\nEnd Sub\n\n\nFunction ToDisplayName(status As Outlook.OlTaskStatus) As String\n    Select Case status\n        Case Outlook.OlTaskStatus.olTaskComplete\n            ToDisplayName = \"完了\"\n        Case Outlook.OlTaskStatus.olTaskDeferred\n            ToDisplayName = \"遅延\"\n        Case Outlook.OlTaskStatus.olTaskInProgress\n            ToDisplayName = \"進行中\"\n        Case Outlook.OlTaskStatus.olTaskNotStarted\n            ToDisplayName = \"未着手\"\n        Case Outlook.OlTaskStatus.olTaskWaiting\n            ToDisplayName = \"待機中\"\n        Case Else\n            ToDisplayName = \"UNKNOWN\"\n    End Select\nEnd Function\n\n```\n","coediting":false,"comments_count":0,"created_at":"2019-11-08T21:44:38+09:00","group":null,"id":"9c7c45be2a57e75336b9","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"VBA","versions":[]}],"title":"Outlookのタスク機能からタスク一覧をエクスポートするVBA","updated_at":"2019-11-08T21:44:38+09:00","url":"https://qiita.com/neko_the_shadow/items/9c7c45be2a57e75336b9","user":{"description":"IT業界の片隅でひっそり生きるシステムエンジニアです(´・ω・｀)","facebook_id":"","followees_count":0,"followers_count":33,"github_login_name":null,"id":"neko_the_shadow","items_count":169,"linkedin_id":"","location":"神奈川県川崎市","name":"","organization":"","permanent_id":105859,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/105859/profile-images/1473709753","team_only":false,"twitter_screen_name":"neko_the_shadow","website_url":"https://nekotheshadow.github.io/"},"page_views_count":null}