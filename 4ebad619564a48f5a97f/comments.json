[{"body":"ほんの少しですけど、\nこっちより\n\n```python\ndef primes(x):\n    if x < 2: return []\n​\n    primes = [i for i in range(x)]\n    primes[1] = 0 # 1は素数ではない\n​\n    # エラトステネスのふるい\n    for prime in primes:\n        if prime > math.sqrt(x): break\n        if prime == 0: continue\n        for non_prime in range(2 * prime, x, prime): primes[non_prime] = 0\n    return [prime for prime in primes if prime != 0]\n```\n\nこっちの方が\n\n```python\ndef primes_ref(x):\n    if x < 2: return []\n\n    primes = [i for i in range(x)]\n    primes[1] = 0 # 1は素数ではない\n    x_sqrt = math.sqrt(x) # 記憶させていちいち計算しない\n    \n    # エラトステネスのふるい\n    for prime in primes:\n        if prime == 0: continue # 先に処理\n        if prime > x_sqrt: break\n        for non_prime in range(2 * prime, x, prime): primes[non_prime] = 0\n\n    return [prime for prime in primes if prime != 0]\n```\n\n速度が出ますね。\n\n```\n%timeit primes(random.randrange(10 ** 5))\n100 loops, best of 3: 10.7 ms per loop\n```\n\n```\n%timeit primes_ref(random.randrange(10 ** 5))\n100 loops, best of 3: 8.56 ms per loop\n```\n","created_at":"2017-03-25T14:05:56+09:00","id":"5b80b7591c617179c843","rendered_body":"<p>ほんの少しですけど、<br>\nこっちより</p>\n\n<div class=\"code-frame\" data-lang=\"python\"><div class=\"highlight\"><pre><code><span class=\"k\">def</span> <span class=\"nf\">primes</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">&lt;</span> <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"k\">return</span> <span class=\"p\">[]</span>\n<span class=\"err\">​</span>\n    <span class=\"n\">primes</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">i</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)]</span>\n    <span class=\"n\">primes</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"c1\"># 1は素数ではない\n</span><span class=\"err\">​</span>\n    <span class=\"c1\"># エラトステネスのふるい\n</span>    <span class=\"k\">for</span> <span class=\"n\">prime</span> <span class=\"ow\">in</span> <span class=\"n\">primes</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">&gt;</span> <span class=\"n\">math</span><span class=\"p\">.</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span> <span class=\"k\">break</span>\n        <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"k\">continue</span>\n        <span class=\"k\">for</span> <span class=\"n\">non_prime</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">prime</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">prime</span><span class=\"p\">):</span> <span class=\"n\">primes</span><span class=\"p\">[</span><span class=\"n\">non_prime</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">prime</span> <span class=\"k\">for</span> <span class=\"n\">prime</span> <span class=\"ow\">in</span> <span class=\"n\">primes</span> <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">]</span>\n</code></pre></div></div>\n\n<p>こっちの方が</p>\n\n<div class=\"code-frame\" data-lang=\"python\"><div class=\"highlight\"><pre><code><span class=\"k\">def</span> <span class=\"nf\">primes_ref</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">&lt;</span> <span class=\"mi\">2</span><span class=\"p\">:</span> <span class=\"k\">return</span> <span class=\"p\">[]</span>\n\n    <span class=\"n\">primes</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">i</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)]</span>\n    <span class=\"n\">primes</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"c1\"># 1は素数ではない\n</span>    <span class=\"n\">x_sqrt</span> <span class=\"o\">=</span> <span class=\"n\">math</span><span class=\"p\">.</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"c1\"># 記憶させていちいち計算しない\n</span>\n    <span class=\"c1\"># エラトステネスのふるい\n</span>    <span class=\"k\">for</span> <span class=\"n\">prime</span> <span class=\"ow\">in</span> <span class=\"n\">primes</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span> <span class=\"k\">continue</span> <span class=\"c1\"># 先に処理\n</span>        <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">&gt;</span> <span class=\"n\">x_sqrt</span><span class=\"p\">:</span> <span class=\"k\">break</span>\n        <span class=\"k\">for</span> <span class=\"n\">non_prime</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">prime</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">prime</span><span class=\"p\">):</span> <span class=\"n\">primes</span><span class=\"p\">[</span><span class=\"n\">non_prime</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">prime</span> <span class=\"k\">for</span> <span class=\"n\">prime</span> <span class=\"ow\">in</span> <span class=\"n\">primes</span> <span class=\"k\">if</span> <span class=\"n\">prime</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">]</span>\n</code></pre></div></div>\n\n<p>速度が出ますね。</p>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>%timeit primes(random.randrange(10 ** 5))\n100 loops, best of 3: 10.7 ms per loop\n</code></pre></div></div>\n\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre><code>%timeit primes_ref(random.randrange(10 ** 5))\n100 loops, best of 3: 8.56 ms per loop\n</code></pre></div></div>\n","updated_at":"2017-03-25T14:05:56+09:00","user":{"description":"The University of Tokyo UI-Lab, \r\nRIKEN AIP Search and Parallel Unit, \r\nRhelixa, Inc. Senior Researcher of Cloud Dev., \r\nAscade, Inc. Software Engineer of System Solution Div.","facebook_id":"","followees_count":2,"followers_count":32,"github_login_name":"suecharo","id":"suecharo","items_count":9,"linkedin_id":"","location":"Tokyo, Japan","name":"Hirotaka Suetake","organization":"The University of Tokyo","permanent_id":149712,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/149712/profile-images/1522146312","team_only":false,"twitter_screen_name":null,"website_url":""}}]